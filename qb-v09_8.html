<!DOCTYPE html>
<!-- Version: v09 - Updated: 20251216-184752 -->

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Quotation Builder v09</title>
<style>
:root{--bg:#f6f8fb;--fg:#1e293b;--pri:#003361;--pri-weak:#e6fbf4;--mut:#64748b;--card:#fff;--bd:#e2e8f0;--warn:#ef4444;--success:#22c55e}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,Segoe UI,system-ui,Arial,sans-serif}
header{position:sticky;top:0;z-index:5;background:#fff;border-bottom:1px solid var(--bd);box-shadow:0 2px 4px rgba(0,0,0,0.05)}
.wrap{max-width:1280px;margin:0 auto;padding:12px 16px;display:flex;gap:10px;align-items:center}
h1{font-size:18px;margin:0;color:#0b7a57;font-weight:700}
.lang{margin-left:auto;display:flex;gap:6px}
.lang button{padding:6px 10px;border:1px solid var(--bd);background:#fff;border-radius:8px;cursor:pointer}
.lang button.active{background:var(--pri-weak);border-color:var(--pri)}
nav.tabs{background:#fff;border-bottom:1px solid var(--bd)}
nav.tabs .wrap{gap:8px;flex-wrap:wrap}
.tabbtn{padding:8px 10px;border:1px solid var(--bd);background:#fff;border-radius:8px;cursor:pointer;font-weight:600}
.tabbtn.active{border-color:var(--pri);color:#075;background:var(--pri-weak)}
main{max-width:1280px;margin:14px auto;display:grid;grid-template-columns:1fr;gap:14px;padding:0 16px}
main.with-sidebar{grid-template-columns:300px 1fr}
aside{background:var(--card);border:1px solid var(--bd);border-radius:12px;padding:12px;height:calc(100vh - 180px);overflow:auto;display:none}
aside.active{display:block}
section.view{background:var(--card);border:1px solid var(--bd);border-radius:12px;padding:14px;min-height:520px}
h2{margin:4px 0 10px}
h3{margin:8px 0 6px;font-size:16px}
.small{font-size:12px;color:var(--mut)}
hr{border:none;border-top:1px solid var(--bd);margin:12px 0}
.row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px;margin-bottom:10px}
.f1{grid-column:span 3}.f2{grid-column:span 4}.f3{grid-column:span 6}.f4{grid-column:span 12}
label{display:block;font-size:12px;color:#334;margin:4px 0}
input,select,textarea{width:100%;padding:8px;border:1px solid #cfd6dd;border-radius:8px;background:#fff}
textarea{min-height:84px}
.badge{display:inline-block;padding:3px 8px;border:1px solid #cfe8de;background:#f2fffa;border-radius:999px;color:#095;font-size:12px}
.list{display:flex;flex-direction:column;gap:6px}
.card{border:1px solid var(--bd);border-radius:10px;padding:10px;margin-bottom:10px}
.card.sel{border-color:var(--pri);box-shadow:0 0 0 2px #bfe}
.btn{padding:8px 10px;border:1px solid var(--bd);background:#fff;border-radius:8px;cursor:pointer}
.btn.pri{border-color:var(--pri);background:var(--pri-weak);color:#075;font-weight:700}
.btn.dan{border-color:#fca5a5;color:#a00}
.hidden{display:none}
.flex{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.progress{height:8px;background:#e2e8f0;border-radius:999px;overflow:hidden}
.progress>span{display:block;height:100%;background:linear-gradient(90deg,#bf1122,#22c55e);width:0%;transition:width 0.3s ease}
.req label::after{content:" *";color:#ef4444}
.note{background:#fffbeb;border:1px solid #fde68a;border-radius:8px;padding:8px;margin-top:10px}
.checkbox-group{display:flex;flex-direction:column;gap:6px;padding:8px;border:1px solid var(--bd);border-radius:8px;background:#fafafa}
.checkbox-item{display:flex;align-items:center;gap:8px}
.checkbox-item input[type="checkbox"]{width:auto}
.phase-section{margin-bottom:20px;padding:16px;border:1px solid var(--bd);border-radius:10px;background:#fafafa}

.phase-header{display:flex;align-items:center;gap:10px;margin-bottom:12px}
.phase-number{width:32px;height:32px;border-radius:50%;background:var(--pri);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
.phase-title{font-size:18px;font-weight:700}
.status-selector{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.status-option{padding:6px 12px;border:1px solid var(--bd);border-radius:6px;cursor:pointer;background:#fff}
.status-option.selected{border-color:var(--pri);background:var(--pri-weak);font-weight:600}
.validation-gate{background:#fffbeb;border:2px solid #fbbf24;border-radius:8px;padding:12px;margin:12px 0}
.validation-gate.passed{background:#f0fdf4;border-color:#86efac}

  
  @media print {
    /* Hide UI elements */
    header, .tab-nav, button, .btn, .validation-gate, .exportBar {
      display: none !important;
    }
    
    /* Main content */
    body {
      background: white !important;
    }
    
    main {
      max-width: 100% !important;
      padding: 0 !important;
      background: white !important;
    }
    
    #previewDocument {
      max-width: 100% !important;
      margin: 0 !important;
      padding: 20mm !important;
      box-shadow: none !important;
    }
    
    /* Typography */
    h1 { font-size: 24pt; }
    h2 { font-size: 18pt; }
    h3 { font-size: 14pt; }
    p, div { font-size: 10pt; }
    
    /* Page breaks */
    .card, .optCard {
      page-break-inside: avoid;
      border: 1px solid #ddd !important;
      box-shadow: none !important;
      margin-bottom: 10mm !important;
    }
    
    h1, h2, h3 {
      page-break-after: avoid;
    }
    
    /* Colors for print */
    * {
      color: black !important;
      background: white !important;
    }
    
    /* Keep brand colors */
    [style*="color:#003361"] {
      color: #003361 !important;
    }
    
    [style*="color:#bf1122"] {
      color: #bf1122 !important;
    }
    
    /* Page settings */
    @page {
      margin: 15mm;
      size: A4 portrait;
    }
  }

</style>
</head>
<body>
<header>
  <div class="wrap">
    <svg width="120" height="40" viewBox="0 0 120 40" style="margin-right:15px">
      <text x="5" y="28" font-family="Arial, sans-serif" font-size="22" font-weight="700" fill="#000">Trustech</text>
      <rect x="100" y="10" width="6" height="6" fill="#000"/>
      <rect x="108" y="10" width="6" height="6" fill="#000"/>
      <rect x="108" y="18" width="6" height="6" fill="#000"/>
    </svg>
    <div style="flex:1">
      <h1 style="margin:0">Quotation Builder v09</h1>
      <div class="small" style="color:#666">7 Steps / 7 Equipments</div>
    </div>
    <div class="flex" style="min-width:260px">
      <div class="progress" style="flex:1"><span id="progressBar"></span></div>
      <span class="small" id="progressText" style="width:64px;text-align:right">0%</span>
    </div>
    <div class="lang">
      <button id="btnEN">EN</button>
      <button id="btnFR">FR</button>
    </div>
    <div class="flex">
      <button class="btn" id="saveProject">Save JSON</button>
      <button class="btn" id="loadBtn">Load JSON</button>
      <button class="btn dan" id="resetBtn" title="Clear all data and reset">Reset All</button>
      <input type="file" id="loadProject" class="hidden" accept=".json"/>
    </div>
  </div>
  <nav class="tabs">
    <div class="wrap" id="navTabs"></div>
  </nav>
</header>

<main>
  <!-- Sidebar removed for full-width Step 4 -->

  <section class="view">
    <div id="stepContainer"></div>
  </section>
</main>

<script>
// i18n
var T = {
  EN: {
    project: 'Step 1 ‚Ä¢ Project Header',
    site: 'Step 2 ‚Ä¢ Site Capture',
    perf: 'Step 3 ‚Ä¢ Review & Target Alignment',
    opts: 'Step 4 ‚Ä¢ Option Builder',
    cost: 'Step 5 ‚Ä¢ Cost & Pricing',
    contract: 'Step 6 ‚Ä¢ Contract & Warranty',
    preview: 'Step 7 ‚Ä¢ Preview & Export',
    equip: 'Equip Specs',
    projectName: 'Project Name',
    clientName: 'Client Name',
    quoteId: 'Quote ID',
    revision: 'Revision',
    preparedBy: 'Prepared By',
    approvedBy: 'Approved By',
    validityDate: 'Validity Date',
    clientRef: 'Client Reference',
    ndaInPlace: 'NDA in Place',
    siteLocation: 'Site Location',
    internalNotes: 'Internal Notes',
    customerNotes: 'Customer Notes',
    installContext: 'Install Context',
    ambientTmin: 'Ambient T min (¬∞C)',
    ambientTmax: 'Ambient T max (¬∞C)',
    explosionClass: 'Explosion Class',
    voltageService: 'Voltage Service',
    utilities: 'Utilities',
    emissionLimit: 'Emission Limit (mg/Nm¬≥)',
    noiseLimit: 'Noise Limit (dBA)',
    accessHandling: 'Access / Handling',
    floorArea: 'Floor Area (m¬≤)',
    headroom: 'Headroom (m)',
    engineerNotes: 'Engineer Notes',
    phase1: 'Phase 1 ‚Äî Site Review',
    phase2: 'Phase 2 ‚Äî Meeting Outcome',
    phase3: 'Phase 3 ‚Äî Performance Target Setting',
    siteReview: 'Site Information Review',
    keyAgreements: 'Key Agreements',
    openPoints: 'Open Points',
    actionItems: 'Action Items',
    decisionDate: 'Decision Date',
    validationStatus: 'Client Validation Status',
    globalTargets: 'Global Production Targets',
    throughput: 'Throughput (tph)',
    availability: 'Availability (%)',
    deliveryTimeline: 'Delivery Timeline',
    environmental: 'Environmental & Compliance',
    emission: 'Emission (mg/Nm¬≥)',
    noise: 'Noise (dBA)',
    regulatoryRef: 'Regulatory Reference',
    energyEfficiency: 'Energy & Efficiency',
    energyKwh: 'Energy (kWh/t)',
    recoveryKpi: 'Recovery / Efficiency KPI',
    utilityConstraints: 'Utility Constraints',
    priorityMatrix: 'Priority & Trade-off Matrix',
    equipOverrides: 'Equipment-Specific Overrides',
    assumptions: 'Assumptions & Boundaries',
    operatingBasis: 'Operating Basis',
    feedVariability: 'Feed Variability',
    exclusions: 'Exclusions (Scope Out)',
    customerValidation: 'Customer Validation Status',
    validationDate: 'Validation Date',
    meetingRefId: 'Meeting Reference ID',
    meetingSummary: 'Meeting Summary',
    confirmedByClient: 'Confirmed by Client',
    pendingValidation: 'Pending Validation',
    internalProposal: 'Internal Proposal Only',
    confirm: 'Confirm',
    pending: 'Pending',
    revisit: 'Revisit',
    addNote: 'Add Note',
    optionA: 'Option A',
    optionB: 'Option B',
    optionC: 'Option C',
    optionType: 'Option Type',
    minCapex: 'Minimum CAPEX',
    capacityDriven: 'Capacity Driven',
    futureProof: 'Future Proof',
    engineeringSummary: 'Engineering Summary',
    systemsEquipments: 'Systems & Equipments',
    engineeringItems: 'Engineering Item List (BOM)',
    optionNotes: 'Option Notes & Assumptions',
    autoDraft: 'Auto Draft',
    addEquipment: 'Add Equipment',
    addSystem: 'Add System',
    addItem: 'Add Item',
    category: 'Category',
    description: 'Description',
    qty: 'Qty',
    unit: 'Unit',
    scope: 'Scope',
    included: 'Included',
    optional: 'Optional',
    freight: 'Freight',
    freightNotes: 'Freight Notes',
    documents: 'Reference Documents & Notes',
    uploadDocument: 'Upload Document',
    selectFile: 'Click to select file...',
    siteFiles: 'Site Photos, Drawings & Voice Notes',
    uploadFile: 'Upload File',
    costPricing: 'Cost & Pricing',
    laborRate: 'Labor Rate ($/hr)',
    marginPct: 'Margin (%)',
    freightPct: 'Freight (%)',
    optionSummary: 'Option Summary',
    totalCapex: 'Total CAPEX',
    totalCost: 'Total Cost',
    sellingPrice: 'Selling Price',
    exportCost: 'Export Cost Sheet',
    contractWarranty: 'Contract & Warranty',
    paymentTerms: 'Payment Terms',
    deliveryTime: 'Delivery Time (weeks)',
    warrantyPeriod: 'Warranty Period (months)',
    warrantyNotes: 'Warranty Notes',
    exclusions: 'Exclusions',
    specialConditions: 'Special Conditions',
    standardNotes: 'Standard Contract Notes',
    note: 'Note',
    laborRateGrid: 'Grille Tarifaire | Main d\'Oeuvre',
    laborRatesValid2025: 'Les taux horaires, de jour sur semaine, en vigueur pour 2025 sont (*):',
    conceptionDesign: 'CONCEPTION ET DESSINS DE PI√àCES',
    mechanicSupervision: 'M√âCANIQUE - SUPERVISION - MONTAGE - MAINTENANCE',
    additionalRates: 'FRAIS ADDITIONNELS',
    engineerSenior: 'Ing√©nieur-S√©nior',
    engineerStandard: 'Ing√©nieur-Standard',
    designer: 'Concepteur',
    technicianDraftsman: 'Technicien-Dessinateur',
    adminSupport: 'Secr√©tariat et personnel de soutien',
    specialistDryer: 'Technicien-Sp√©cialiste ‚Äì S√©choir ‚Äì √âquilibrage',
    supervisorSenior: 'Technicien Superviseur S√©nior Sp√©cialis√©',
    supervisorStandard: 'Technicien Superviseur Standard',
    foremanMechanical: 'Contrema√Ætre M√©canique',
    mechanicWelder: 'M√©canicien Soudeur',
    assistantMechanic: 'Assistant M√©canicien',
    supplies: 'Fournitures (gants, masques, autres)',
    travelFees: 'Les frais de voyagement sont de',
    accommodation: 'Si l\'h√©bergement local est n√©cessaire, les frais de',
    mealAllowance: 'Si requis par l\'horaire, des frais de subsistance de',
    overtimeSaturday: 'Temps suppl√©mentaire et les Samedi seront charg√©s √†',
    sundayHolidays: 'Les Dimanche ainsi que les jours f√©ri√©s seront charg√©s √†',
    ratesSubjectToChange: '(*) Taux sujets √† changement sans pr√©avis.',
    contractNotes: 'Notes Contractuelles',
    addAdditionalNote: '+ Ajouter Note Additionnelle',
    standardTrustechNotes: '‚úì Les 7 notes standard Trustech',
    checkNotesForStep7: '‚òë Cochez les notes √† inclure dans le document final (Step 7)',
    additionalNotes: 'NOTES ADDITIONNELLES',
    deleteAdditionalNote: 'Supprimer cette note additionnelle?',
    laborRateGrid: 'Labor Rate Grid | Workforce',
    laborRatesValid2025: 'Hourly rates, weekday daytime, valid for 2025 (*):',
    conceptionDesign: 'DESIGN & ENGINEERING',
    mechanicSupervision: 'MECHANICAL - SUPERVISION - ASSEMBLY - MAINTENANCE',
    additionalRates: 'ADDITIONAL RATES',
    engineerSenior: 'Senior Engineer',
    engineerStandard: 'Standard Engineer',
    designer: 'Designer',
    technicianDraftsman: 'Technician-Draftsman',
    adminSupport: 'Administrative & Support Staff',
    specialistDryer: 'Specialist Technician - Dryer - Balancing',
    supervisorSenior: 'Senior Specialized Supervisor',
    supervisorStandard: 'Standard Supervisor',
    foremanMechanical: 'Mechanical Foreman',
    mechanicWelder: 'Mechanic Welder',
    assistantMechanic: 'Assistant Mechanic',
    supplies: 'Supplies (gloves, masks, others)',
    travelFees: 'Travel fees',
    accommodation: 'Local accommodation (if necessary)',
    mealAllowance: 'Meal allowance (if required)',
    overtimeSaturday: 'Overtime and Saturday will be charged at',
    sundayHolidays: 'Sunday and holidays will be charged at',
    ratesSubjectToChange: '(*) Rates subject to change without notice.',
    contractNotes: 'CONTRACT NOTES',
    addAdditionalNote: '+ Add Additional Note',
    standardTrustechNotes: '‚úì Standard Trustech notes',
    checkNotesForStep7: '‚òë Check notes to include in final document (Step 7)',
    additionalNotes: 'ADDITIONAL NOTES',
    deleteAdditionalNote: 'Delete this additional note?',
    docType: 'Document Type',
    internal: 'Internal',
    customer: 'Customer',
    aiSummary: 'AI Summary',
    generateSummary: 'Generate Summary',
    noDocuments: 'No documents uploaded yet'
  },
  FR: {
    project: '√âtape 1 ‚Ä¢ En-t√™te du projet',
    site: '√âtape 2 ‚Ä¢ Capture du site',
    perf: '√âtape 3 ‚Ä¢ Revue & Alignement',
    opts: '√âtape 4 ‚Ä¢ Options',
    cost: '√âtape 5 ‚Ä¢ Co√ªts & Prix',
    contract: '√âtape 6 ‚Ä¢ Contrat',
    preview: '√âtape 7 ‚Ä¢ Aper√ßu',
    equip: 'Sp√©cifications',
    projectName: 'Nom du projet',
    clientName: 'Nom du client',
    quoteId: 'ID de soumission',
    revision: 'R√©vision',
    preparedBy: 'Pr√©par√© par',
    approvedBy: 'Approuv√© par',
    validityDate: 'Date de validit√©',
    clientRef: 'R√©f√©rence client',
    ndaInPlace: 'Entente de confidentialit√©',
    siteLocation: 'Localisation',
    internalNotes: 'Notes internes',
    customerNotes: 'Notes client',
    installContext: 'Contexte installation',
    ambientTmin: 'T min (¬∞C)',
    ambientTmax: 'T max (¬∞C)',
    explosionClass: 'Classe explosion',
    voltageService: 'Tension',
    utilities: 'Services',
    emissionLimit: 'Limite √©mission',
    noiseLimit: 'Limite bruit',
    accessHandling: 'Acc√®s / Manutention',
    floorArea: 'Surface (m¬≤)',
    headroom: 'Hauteur (m)',
    engineerNotes: 'Notes ing√©nieur',
    phase1: 'Phase 1 ‚Äî Revue site',
    phase2: 'Phase 2 ‚Äî R√©union',
    phase3: 'Phase 3 ‚Äî Objectifs',
    siteReview: 'Revue du site',
    keyAgreements: 'Accords cl√©s',
    openPoints: 'Points ouverts',
    actionItems: 'Actions',
    decisionDate: 'Date d√©cision',
    validationStatus: 'Statut validation',
    globalTargets: 'Objectifs globaux',
    throughput: 'D√©bit (tph)',
    availability: 'Disponibilit√© (%)',
    deliveryTimeline: 'Livraison',
    environmental: 'Environnement',
    emission: '√âmission',
    noise: 'Bruit',
    regulatoryRef: 'R√©f√©rence r√©glementaire',
    energyEfficiency: '√ânergie & Efficacit√©',
    energyKwh: '√ânergie (kWh/t)',
    recoveryKpi: 'KPI efficacit√©',
    utilityConstraints: 'Contraintes services',
    priorityMatrix: 'Matrice priorit√©s',
    equipOverrides: 'D√©rogations √©quipement',
    assumptions: 'Hypoth√®ses & Limites',
    operatingBasis: 'Base op√©ration',
    feedVariability: 'Variabilit√© alimentation',
    exclusions: 'Exclusions',
    customerValidation: 'Validation client',
    validationDate: 'Date validation',
    meetingRefId: 'R√©f. r√©union',
    meetingSummary: 'R√©sum√© r√©union',
    confirmedByClient: 'Confirm√© client',
    pendingValidation: 'En attente',
    internalProposal: 'Proposition interne',
    confirm: 'Confirmer',
    pending: 'En attente',
    revisit: 'Revoir',
    addNote: 'Ajouter note',
    optionA: 'Option A',
    optionB: 'Option B',
    optionC: 'Option C',
    optionType: 'Type option',
    minCapex: 'CAPEX Minimum',
    capacityDriven: 'Capacit√©',
    futureProof: 'P√©renne',
    engineeringSummary: 'R√©sum√© ing√©nierie',
    systemsEquipments: 'Syst√®mes & √âquipements',
    engineeringItems: 'Liste items (BOM)',
    optionNotes: 'Notes & Hypoth√®ses',
    autoDraft: '√âbauche auto',
    addEquipment: 'Ajouter √©quipement',
    addSystem: 'Ajouter syst√®me',
    addItem: 'Ajouter item',
    category: 'Cat√©gorie',
    description: 'Description',
    qty: 'Qt√©',
    unit: 'Unit√©',
    scope: 'Port√©e',
    included: 'Inclus',
    optional: 'Optionnel',
    freight: 'Transport',
    freightNotes: 'Notes transport',
    documents: 'Documents & Notes de r√©f√©rence',
    uploadDocument: 'T√©l√©charger document',
    selectFile: 'Cliquer pour s√©lectionner...',
    siteFiles: 'Photos, Plans & Notes vocales',
    uploadFile: 'T√©l√©charger fichier',
    costPricing: 'Co√ªts & Prix',
    laborRate: 'Taux horaire ($/h)',
    marginPct: 'Marge (%)',
    freightPct: 'Transport (%)',
    optionSummary: 'R√©sum√© option',
    totalCapex: 'CAPEX total',
    totalCost: 'Co√ªt total',
    sellingPrice: 'Prix de vente',
    exportCost: 'Exporter feuille co√ªts',
    contractWarranty: 'Contrat & Garantie',
    paymentTerms: 'Conditions paiement',
    deliveryTime: 'D√©lai livraison (semaines)',
    warrantyPeriod: 'P√©riode garantie (mois)',
    warrantyNotes: 'Notes garantie',
    exclusions: 'Exclusions',
    specialConditions: 'Conditions sp√©ciales',
    standardNotes: 'Notes contrat standard',
    note: 'Note',
    laborRateGrid: 'Grille Tarifaire | Main d\'Oeuvre',
    laborRatesValid2025: 'Les taux horaires, de jour sur semaine, en vigueur pour 2025 sont (*):',
    conceptionDesign: 'CONCEPTION ET DESSINS DE PI√àCES',
    mechanicSupervision: 'M√âCANIQUE - SUPERVISION - MONTAGE - MAINTENANCE',
    additionalRates: 'FRAIS ADDITIONNELS',
    engineerSenior: 'Ing√©nieur-S√©nior',
    engineerStandard: 'Ing√©nieur-Standard',
    designer: 'Concepteur',
    technicianDraftsman: 'Technicien-Dessinateur',
    adminSupport: 'Secr√©tariat et personnel de soutien',
    specialistDryer: 'Technicien-Sp√©cialiste ‚Äì S√©choir ‚Äì √âquilibrage',
    supervisorSenior: 'Technicien Superviseur S√©nior Sp√©cialis√©',
    supervisorStandard: 'Technicien Superviseur Standard',
    foremanMechanical: 'Contrema√Ætre M√©canique',
    mechanicWelder: 'M√©canicien Soudeur',
    assistantMechanic: 'Assistant M√©canicien',
    supplies: 'Fournitures (gants, masques, autres)',
    travelFees: 'Les frais de voyagement sont de',
    accommodation: 'Si l\'h√©bergement local est n√©cessaire, les frais de',
    mealAllowance: 'Si requis par l\'horaire, des frais de subsistance de',
    overtimeSaturday: 'Temps suppl√©mentaire et les Samedi seront charg√©s √†',
    sundayHolidays: 'Les Dimanche ainsi que les jours f√©ri√©s seront charg√©s √†',
    ratesSubjectToChange: '(*) Taux sujets √† changement sans pr√©avis.',
    contractNotes: 'Notes Contractuelles',
    addAdditionalNote: '+ Ajouter Note Additionnelle',
    standardTrustechNotes: '‚úì Les 7 notes standard Trustech',
    checkNotesForStep7: '‚òë Cochez les notes √† inclure dans le document final (Step 7)',
    additionalNotes: 'NOTES ADDITIONNELLES',
    deleteAdditionalNote: 'Supprimer cette note additionnelle?',
    laborRateGrid: 'Labor Rate Grid | Workforce',
    laborRatesValid2025: 'Hourly rates, weekday daytime, valid for 2025 (*):',
    conceptionDesign: 'DESIGN & ENGINEERING',
    mechanicSupervision: 'MECHANICAL - SUPERVISION - ASSEMBLY - MAINTENANCE',
    additionalRates: 'ADDITIONAL RATES',
    engineerSenior: 'Senior Engineer',
    engineerStandard: 'Standard Engineer',
    designer: 'Designer',
    technicianDraftsman: 'Technician-Draftsman',
    adminSupport: 'Administrative & Support Staff',
    specialistDryer: 'Specialist Technician - Dryer - Balancing',
    supervisorSenior: 'Senior Specialized Supervisor',
    supervisorStandard: 'Standard Supervisor',
    foremanMechanical: 'Mechanical Foreman',
    mechanicWelder: 'Mechanic Welder',
    assistantMechanic: 'Assistant Mechanic',
    supplies: 'Supplies (gloves, masks, others)',
    travelFees: 'Travel fees',
    accommodation: 'Local accommodation (if necessary)',
    mealAllowance: 'Meal allowance (if required)',
    overtimeSaturday: 'Overtime and Saturday will be charged at',
    sundayHolidays: 'Sunday and holidays will be charged at',
    ratesSubjectToChange: '(*) Rates subject to change without notice.',
    contractNotes: 'CONTRACT NOTES',
    addAdditionalNote: '+ Add Additional Note',
    standardTrustechNotes: '‚úì Standard Trustech notes',
    checkNotesForStep7: '‚òë Check notes to include in final document (Step 7)',
    additionalNotes: 'ADDITIONAL NOTES',
    deleteAdditionalNote: 'Delete this additional note?',
    docType: 'Type de document',
    internal: 'Interne',
    customer: 'Client',
    aiSummary: 'R√©sum√© IA',
    generateSummary: 'G√©n√©rer r√©sum√©',
    noDocuments: 'Aucun document t√©l√©charg√©'
  }
};

var LANG = 'EN';
var currentTab = 'project';

// Equipment Templates Library (7 types from Product Lineup Excel)
var EQUIPMENT_TEMPLATES = {
  "01. AFS - Air Filtration System": {
    code: "AFS",
    category: "Air Filtration",
    fields: [
      {group: "Air Performance", label: "Design Airflow", unit: "CFM", type: "number", required: true},
      {group: "Air Performance", label: "Static Pressure", unit: "in.WG", type: "number", required: true},
      {group: "Air Performance", label: "Air-to-Cloth Ratio", unit: "ft/min", type: "number", required: true},
      {group: "Filter Section", label: "Filter Type", unit: "", type: "select", options: ["Bag", "Cartridge"], required: true},
      {group: "Filter Section", label: "Filter Material", unit: "", type: "select", options: ["Polyester", "PTFE", "Aramid"], required: true},
      {group: "Filter Section", label: "Filter Quantity", unit: "ea", type: "number", required: true},
      {group: "Cleaning Section", label: "Pulse Valves", unit: "ea", type: "number", required: true},
      {group: "Hopper Section", label: "Hopper Count", unit: "ea", type: "number", required: true},
      {group: "Fan Section", label: "Fan Capacity", unit: "CFM", type: "number", required: true},
      {group: "Fan Section", label: "Fan Motor Power", unit: "HP", type: "number", required: true},
      {group: "Safety", label: "Grounding Verified", unit: "", type: "select", options: ["Yes", "No"], required: false}
    ]
  },
  "02. CONV - Conveyor System": {
    code: "CONV",
    category: "Material Handling",
    fields: [
      {group: "Type", label: "Conveying Type", unit: "", type: "select", options: ["Pneumatic", "Mechanical"], required: true},
      {group: "Capacity", label: "Throughput", unit: "tph", type: "number", required: true},
      {group: "Pneumatic", label: "Blower Power", unit: "HP", type: "number", required: false},
      {group: "Mechanical", label: "Screw Diameter", unit: "in", type: "number", required: false},
      {group: "Control", label: "VFD Applied", unit: "", type: "select", options: ["Yes", "No"], required: false}
    ]
  },
  "03. SILO - Silo Storage": {
    code: "SILO",
    category: "Storage",
    fields: [
      {group: "Capacity", label: "Total Volume", unit: "m¬≥", type: "number", required: true},
      {group: "Structure", label: "Diameter", unit: "ft", type: "number", required: true},
      {group: "Structure", label: "Straight Height", unit: "ft", type: "number", required: true},
      {group: "Discharge", label: "Discharge Type", unit: "", type: "select", options: ["Rotary Valve", "Screw", "Pinch"], required: true},
      {group: "Safety", label: "Explosion Vent", unit: "", type: "select", options: ["Yes", "No"], required: false}
    ]
  },
  "04. DRYER - Rotary Dryer": {
    code: "DRYER",
    category: "Thermal Processing",
    fields: [
      {group: "Process", label: "Inlet Temperature", unit: "¬∞C", type: "number", required: true},
      {group: "Process", label: "Outlet Temperature", unit: "¬∞C", type: "number", required: true},
      {group: "Capacity", label: "Throughput", unit: "tph", type: "number", required: true},
      {group: "Energy", label: "Burner Capacity", unit: "MMBtu/h", type: "number", required: true},
      {group: "Drive", label: "Motor Power", unit: "HP", type: "number", required: false}
    ]
  },
  "05. GBR-DH - GBR Dryer Hopper": {
    code: "GBR-DH",
    category: "Thermal Processing",
    innovation: true,
    fields: [
      {group: "Process", label: "Inlet Temperature", unit: "¬∞C", type: "number", required: true},
      {group: "Process", label: "Outlet Temperature", unit: "¬∞C", type: "number", required: true},
      {group: "Capacity", label: "Material Flow", unit: "tph", type: "number", required: true},
      {group: "Energy", label: "Heating Power", unit: "kW", type: "number", required: true},
      {group: "Safety", label: "Overheat Protection", unit: "", type: "select", options: ["Yes", "No"], required: false}
    ]
  },
  "06. SILO-DH - Silo Dryer Hopper": {
    code: "SILO-DH",
    category: "Storage & Drying",
    innovation: true,
    fields: [
      {group: "Capacity", label: "Usable Volume", unit: "m¬≥", type: "number", required: true},
      {group: "Process", label: "Airflow Rate", unit: "CFM", type: "number", required: true},
      {group: "Heating", label: "Heater Power", unit: "kW", type: "number", required: true},
      {group: "Control", label: "Humidity Control", unit: "", type: "select", options: ["Yes", "No"], required: false},
      {group: "Safety", label: "Pressure Relief", unit: "", type: "select", options: ["Yes", "No"], required: false}
    ]
  },
  "07. ETS - Electro Thermal Stack": {
    code: "ETS",
    category: "Energy Storage",
    innovation: true,
    esg: true,
    fields: [
      {group: "Capacity", label: "Storage Capacity", unit: "kWh", type: "number", required: true},
      {group: "Capacity", label: "Charging Power", unit: "kW", type: "number", required: true},
      {group: "Process", label: "Max Temperature", unit: "¬∞C", type: "number", required: true},
      {group: "Fluid", label: "Working Medium", unit: "", type: "select", options: ["Air", "Oil", "Salt", "Solid"], required: true},
      {group: "Control", label: "PLC Integration", unit: "", type: "select", options: ["Yes", "No"], required: true}
    ]
  }
};


var state = {
  project: {
    header: {
      project_name: '',
      client: '',
      quote_id: '',
      rev: '',
      prepared_by: '',
      approved_by: '',
      validity_date: '',
      client_ref: '',
      nda: '',
      site_location: '',
      internal_notes: '',
      customer_notes: '',
      documents: []
    },
    site: {
      install: '',
      ambient_min: '',
      ambient_max: '',
      explosion: '',
      voltage: '575V/3P',
      utilities: '',
      emission_mgNm3: '',
      noise_dBA: '',
      access_handling: [],
      access_notes: '',
      floor_area_m2: '',
      headroom_m: '',
      engineer_notes: [],
      site_files: []
    },
    targets: {
      site_review_status: 'pending',
      site_review_comments: '',
      meeting_validated: false,
      key_agreements: '',
      open_points: '',
      action_items: '',
      decision_date: '',
      validation_status: 'Pending',
      meeting_summary: '',
      meeting_ref_id: '',
      throughput: '',
      availability_pct: '',
      delivery: '',
      emission: '',
      noise: '',
      regulatory_ref: '',
      energy_kwh_t: '',
      recovery_kpi: '',
      utility_constraints: '',
      priorities: ['Production', 'Emission', 'Energy', 'CAPEX', 'Reliability', 'Schedule'],
      equipment_overrides: {},
      operating_basis: '',
      feed_variability: '',
      exclusions: '',
      customer_validation: 'Internal Proposal Only',
      validation_date: ''
    },
    contract: {
      payment_terms: '30% √† la commande (sur r√©ception de facture). Projet d√©but √† la r√©ception du premier paiement.\n20% Net 45 jours √† la remise des dessins d\'atelier.\n30% avant exp√©dition (paiement doit √™tre re√ßu avant exp√©dition).\n20% Net 45 jours suivant installation (max 60 jours apr√®s exp√©dition).\nNote: Trustech demeure propri√©taire des √©quipements fournis tant que l\'ensemble des paiements ne sont pas compl√©t√©s par le client.',
      delivery_weeks: 16,
      warranty_months: 12,
      warranty_notes: 'Garantie sur efficacit√© de filtration (au niveau des filtres) pour respecter les normes en vigueur pour le d√©poussi√©reur.\nGarantie sur le d√©bit d√©velopp√© par le nouveau ventilateur fourni.\nGarantie g√©n√©rale de 1 an sur la fonctionnalit√© des nouveaux √©quipements et composantes fournies, s\'ils sont op√©r√©s selon les recommandations des manufacturiers et de Trustech.',
      exclusions: 'Aucune garantie sur √©quipements, composantes et mat√©riaux existants qui seront r√©utilis√©s.\nAucune garantie sur les pi√®ces d\'usure tel que filtres, conduits, etc. √† moins qu\'il s\'agisse d\'un d√©faut de fabrication ou d\'installation.\nAucune garantie sur l\'efficacit√© de capture aux points d\'√©mission de poussi√®res.',
      special_conditions: 'Suivant exp√©dition des √©quipements et composantes Trustech ne peut √™tre tenu responsable de tous dommages, pertes, vol, bris, etc. du mat√©riel exp√©di√© qui sera sous la responsabilit√© du client.',
      note1: 'TERMES DE PAIEMENT: 30% √† la commande (sur r√©ception de facture). Projet d√©but √† la r√©ception du premier paiement. 20% Net 45 jours √† la remise des dessins d\'atelier. 30% avant exp√©dition (paiement doit √™tre re√ßu avant exp√©dition). 20% Net 45 jours suivant installation (max 60 jours apr√®s exp√©dition). Note: Trustech demeure propri√©taire des √©quipements fournis tant que l\'ensemble des paiements ne sont pas compl√©t√©s par le client.',
      note2: '√âCH√âANCIER DE LIVRAISON PR√âVU: Suivant r√©ception du premier paiement et du nuage de point (scan 3D) pr√™t √† utiliser avec logiciel Inventor: (a) Ing√©nierie et remise de dessins d\'atelier: 4 √† 6 semaines (b) Fabrication: 12-14 semaines (suivant approbation des dessins d\'atelier)',
      note3: 'RESPONSABILIT√â DE TRUSTECH: Conception, fabrication et fourniture des √©l√©ments d√©crits et retenus √† cette soumission. Ing√©nierie de conception fait en partenariat avec Dynagroup Technologies Inc. Fonctionnalit√© des √©quipements et composantes. Suivant remise des dessins d\'atelier, fourniture au client d\'un prix pour r√©seaux de conduits n√©cessaires et r√©seau de d√©charge d\'air √† l\'atmosph√®re. Le tout selon notre grille tarifaire 2025 en vigueur.',
      note4: 'RESPONSABILIT√â DU CLIENT: Transport, r√©ception et manutention des √©quipements lors de la livraison. Tous les travaux de nature civil/structure afin de recevoir les nouveaux √©quipements (si requis). Layout g√©n√©ral des √©quipements, fourniture d\'un scan 3D. L\'installation compl√®te des √©quipements et composantes. Tout travaux de nature √©lectrique, instrumentation, contr√¥le, pneumatique, civil, etc.',
      note5: 'VALIDIT√â DE LA PROPOSITION: La pr√©sente proposition est valide pour 30 jours. Voir √©galement la Note 7 pour autres notes et exceptions.',
      note6: 'GARANTIES: Garantie sur efficacit√© de filtration (au niveau des filtres) pour respecter les normes en vigueur pour le d√©poussi√©reur. Garantie sur le d√©bit d√©velopp√© par le nouveau ventilateur fourni. Garantie g√©n√©rale de 1 an sur la fonctionnalit√© des nouveaux √©quipements et composantes fournies, s\'ils sont op√©r√©s selon les recommandations des manufacturiers et de Trustech. Option: Si le client d√©sire obtenir une garantie de 2 ans (au lieu de 1 an): le co√ªt associ√© additionnel est de 3500$.',
      note7: 'NOTES & EXCLUSIONS: Advenant des d√©lais dans la livraison et disponibilit√© des √©quipements et composantes ci-haut d√©crit qui affecterait les d√©lais de livraison estim√©s pr√©sent√©s √† la Note 2: aucune p√©nalit√©, dommages-int√©r√™ts liquid√©s et/ou quelconque autre retenu sur le prix de vente √©tabli pourra √™tre charg√© √† Trustech. Suivant exp√©dition des √©quipements et composantes Trustech ne peut √™tre tenu responsable de tous dommages, pertes, vol, bris, etc. du mat√©riel exp√©di√© qui sera sous la responsabilit√© du client. Aucune caution ne sera fournie par Trustech.'
    }
  },
  equipments: [],
  options: [],
  pricing: {
    labor_rate_per_hour: 95,
    margin_percentage: 25,
    freight_percentage: 5,
    travel_rate_km: 0.85,
    accommodation_per_night: 200,
    meal_allowance: 50,
    supplies_per_day: 50,
    overtime_multiplier: 1.5,
    sunday_multiplier: 2.0,
    labor_rates: {
      engineer_senior: 175.00,
      engineer_standard: 150.00,
      designer: 115.00,
      technician_draftsman: 97.50,
      admin_support: 65.00,
      specialist_dryer: 155.00,
      supervisor_senior: 125.00,
      supervisor_standard: 95.00,
      foreman_mechanical: 90.00,
      mechanic_welder: 85.50,
      assistant_mechanic: 80.50
    },
    notes: 'Taux horaires 2025 - Trustech Syst√®mes et Proc√©d√©s Inc.\nTaux sujets √† changement sans pr√©avis.'
  },
  active: null
};

var ACCESS_OPTIONS = [
  'Truck access',
  'Crane required',
  'Forklift available',
  'Indoor installation',
  'Outdoor installation',
  'Limited access',
  'Manual handling only',
  'Existing structure constraint',
  'Phased installation required'
];

function $(sel) {
  return document.querySelector(sel);
}

function el(tag, cls) {
  var elem = document.createElement(tag);
  if (cls) elem.className = cls;
  return elem;
}

function uid(sys) {
  return sys + '-' + Math.random().toString(36).slice(2, 7).toUpperCase();
}

function getv(path) {
  var seg = path.split('.');
  var cur = state;
  for (var i = 0; i < seg.length; i++) {
    if (!cur) return '';
    cur = cur[seg[i]];
  }
  return cur || '';
}

function setv(path, val) {
  var seg = path.split('.');
  var cur = state;
  for (var i = 0; i < seg.length - 1; i++) {
    if (!cur[seg[i]]) cur[seg[i]] = {};
    cur = cur[seg[i]];
  }
  cur[seg[seg.length - 1]] = val;
}

function autosave() {
  try {
    localStorage.setItem('qb_state_v09', JSON.stringify(state));
    computeProgress();
  } catch (e) {}
}

function computeProgress() {
  var req = 0, ok = 0;
  var h = state.project.header;
  if (h.project_name) ok++;
  req++;
  if (h.client) ok++;
  req++;
  if (h.quote_id) ok++;
  req++;
  if (h.rev && h.rev !== '') ok++;
  req++;
  if (h.nda && h.nda !== '') ok++;
  req++;
  
  var s = state.project.site;
  if (s.install && s.install !== '') ok++;
  req++;
  if (s.ambient_min !== '' && s.ambient_min !== null && s.ambient_min !== undefined) ok++;
  req++;
  if (s.ambient_max !== '' && s.ambient_max !== null && s.ambient_max !== undefined) ok++;
  req++;
  if (s.explosion && s.explosion !== '') ok++;
  req++;
  if (s.voltage && s.voltage !== '') ok++;
  req++;
  
  if (state.project.targets.site_review_status === 'confirmed') ok++;
  req++;
  if (state.project.targets.meeting_validated) ok++;
  req++;
  
  var t = state.project.targets;
  if (t.throughput) ok++;
  req++;
  if (t.emission) ok++;
  req++;
  
  // Check if at least one option is reasonably complete
  if (state.options && state.options.length > 0) {
    var hasCompleteOption = false;
    for (var i = 0; i < state.options.length; i++) {
      var opt = state.options[i];
      if (opt.summary && opt.summary.length > 50 && 
          opt.equipments && opt.equipments.length > 0) {
        hasCompleteOption = true;
        break;
      }
    }
    if (hasCompleteOption) ok++;
  }
  req++;
  
  if (state.equipments.length > 0) ok++;
  req++;
  
  var pct = req > 0 ? Math.round((ok / req) * 100) : 0;
  var bar = $('#progressBar');
  var text = $('#progressText');
  if (bar) bar.style.width = pct + '%';
  if (text) text.textContent = pct + '%';
}

function paintTabs() {
  var nav = $('#navTabs');
  nav.innerHTML = '';
  var steps = ['project', 'site', 'perf', 'opts', 'cost', 'contract', 'preview'];
  for (var i = 0; i < steps.length; i++) {
    var b = el('button', 'tabbtn');
    b.textContent = T[LANG][steps[i]];
    b.dataset.tab = steps[i];
    b.onclick = (function(id) {
      return function() { showStep(id); };
    })(steps[i]);
    nav.appendChild(b);
  }
  var b2 = el('button', 'tabbtn');
  b2.textContent = T[LANG].equip;
  b2.dataset.tab = 'equip';
  b2.onclick = function() { showStep('equip'); };
  nav.appendChild(b2);
}

function activateTab(id) {
  var tabs = document.querySelectorAll('.tabbtn');
  for (var i = 0; i < tabs.length; i++) {
    tabs[i].classList.toggle('active', tabs[i].dataset.tab === id);
  }
}

function formGrid(children) {
  var d = el('div', 'row');
  for (var i = 0; i < children.length; i++) {
    d.appendChild(children[i]);
  }
  return d;
}

function field(def, path) {
  var w = el('div', (def.req ? 'req ' : '') + (def.w || 'f2'));
  var label = el('label');
  label.textContent = def.label + (def.u ? ' (' + def.u + ')' : '');
  
  var input;
  if (def.type === 'select') {
    input = el('select');
    var opts = def.opts || [];
    for (var i = 0; i < opts.length; i++) {
      var o = el('option');
      o.value = opts[i];
      o.textContent = opts[i];
      input.appendChild(o);
    }
    input.value = getv(path) || (opts.length > 0 ? opts[0] : '');
  } else if (def.type === 'number') {
    input = el('input');
    input.type = 'number';
    input.value = getv(path) || '';
  } else if (def.type === 'textarea') {
    input = el('textarea');
    input.value = getv(path) || '';
  } else {
    input = el('input');
    input.type = 'text';
    input.value = getv(path) || '';
  }
  
  input.oninput = function() {
    setv(path, input.value);
    computeProgress();
    autosave();
  };
  
  w.appendChild(label);
  w.appendChild(input);
  return w;
}


// BOM Generation Rules
var BOM_RULES = {
  "01. AFS - Air Filtration System": {
    "Equipment": [
      {desc: "Baghouse Dust Collector Unit", qty: 1, unit: "ea"},
      {desc: "Filter Bags - {Filter Material}", qtyFrom: "Filter Quantity", unit: "ea"},
      {desc: "Pulse Cleaning System", qty: 1, unit: "lot"}
    ],
    "Electrical": [
      {desc: "Induced Draft Fan - {Fan Motor Power} HP", qty: 1, unit: "ea"}
    ],
    "Installation": [
      {desc: "Installation Labor", qty: 40, unit: "hrs"}
    ]
  },
  "02. CONV - Conveyor System": {
    "Equipment": [
      {desc: "Conveyor System", qty: 1, unit: "ea"}
    ],
    "Installation": [
      {desc: "Installation Labor", qty: 24, unit: "hrs"}
    ]
  },
  "03. SILO - Silo Storage": {
    "Equipment": [
      {desc: "Storage Silo - {Total Volume} m¬≥", qty: 1, unit: "ea"}
    ],
    "Fabrication": [
      {desc: "Silo Structure & Hopper", qty: 1, unit: "lot"}
    ]
  },
  "04. DRYER - Rotary Dryer": {
    "Equipment": [
      {desc: "Rotary Dryer - {Burner Capacity} MMBtu/h", qty: 1, unit: "ea"}
    ],
    "Installation": [
      {desc: "Installation", qty: 80, unit: "hrs"}
    ]
  },
  "05. GBR-DH - GBR Dryer Hopper": {
    "Equipment": [
      {desc: "GBR Dryer Hopper - {Heating Power} kW", qty: 1, unit: "ea"}
    ],
    "Installation": [
      {desc: "Installation", qty: 40, unit: "hrs"}
    ]
  },
  "06. SILO-DH - Silo Dryer Hopper": {
    "Equipment": [
      {desc: "Silo Dryer Hopper - {Heater Power} kW", qty: 1, unit: "ea"}
    ],
    "Installation": [
      {desc: "Installation", qty: 32, unit: "hrs"}
    ]
  },
  "07. ETS - Electro Thermal Stack": {
    "Equipment": [
      {desc: "Thermal Storage - {Storage Capacity} kWh", qty: 1, unit: "ea"}
    ],
    "Controls": [
      {desc: "PLC Control System", condition: "PLC Integration=Yes", qty: 1, unit: "ea"}
    ],
    "Installation": [
      {desc: "Installation", qty: 40, unit: "hrs"}
    ]
  }
};

function generateBOMFromEquipment() {
  if (!state.activeOption) return;
  var option = state.options[state.activeOption];
  if (!option.equipments || option.equipments.length === 0) {
    alert('No equipment. Add equipment first.');
    return;
  }
  
  var generated = [];
  
  for (var e = 0; e < option.equipments.length; e++) {
    var eq = option.equipments[e];
    if (!eq.template || !BOM_RULES[eq.template]) continue;
    
    var rules = BOM_RULES[eq.template];
    var eqQty = parseInt(eq.qty) || 1;
    
    for (var category in rules) {
      var items = rules[category];
      
      for (var i = 0; i < items.length; i++) {
        var rule = items[i];
        
        if (rule.condition) {
          var parts = rule.condition.split('=');
          if (!eq.specs || eq.specs[parts[0]] !== parts[1]) continue;
        }
        
        var qty = rule.qty || 1;
        if (rule.qtyFrom && eq.specs && eq.specs[rule.qtyFrom]) {
          qty = parseInt(eq.specs[rule.qtyFrom]) || 1;
        }
        qty = qty * eqQty;
        
        var desc = rule.desc;
        var matches = desc.match(/\{([^}]+)\}/g);
        if (matches) {
          for (var m = 0; m < matches.length; m++) {
            var param = matches[m].slice(1, -1);
            var value = eq.specs && eq.specs[param] ? eq.specs[param] : '‚Äî';
            desc = desc.replace(matches[m], value);
          }
        }
        
        desc = eq.name + ' - ' + desc;
        
        generated.push({
          cat: category,
          desc: desc,
          qty: qty,
          unit: rule.unit,
          scope: 'Included'
        });
      }
    }
  }
  
  if (generated.length === 0) {
    alert('No BOM items. Assign templates to equipment.');
    return;
  }
  
  if (!option.items) option.items = [];
  var added = 0;
  
  for (var i = 0; i < generated.length; i++) {
    var exists = false;
    for (var j = 0; j < option.items.length; j++) {
      if (option.items[j].desc === generated[i].desc) {
        exists = true;
        break;
      }
    }
    if (!exists) {
      option.items.push(generated[i]);
      added++;
    }
  }
  
  autosave();
  showStep('opts');
  alert('‚úì Generated ' + added + ' BOM items');
}



// Meeting file upload handler
function handleMeetingFileUpload(file) {
  if (!state.project.targets) {
    state.project.targets = {};
  }
  
  // Show loading modal
  var overlay = el('div');
  overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:2000;display:flex;align-items:center;justify-content:center';
  
  var modal = el('div');
  modal.style.cssText = 'background:#fff;border-radius:12px;padding:40px;max-width:500px;text-align:center';
  
  var icon = el('div');
  icon.style.cssText = 'font-size:48px;margin-bottom:20px';
  icon.textContent = 'üéôÔ∏è';
  modal.appendChild(icon);
  
  var title = el('h3');
  title.style.cssText = 'color:#003361;margin-bottom:10px';
  title.textContent = 'Processing Meeting File...';
  modal.appendChild(title);
  
  var desc = el('p');
  desc.style.cssText = 'color:#6b7280;margin-bottom:20px';
  desc.textContent = 'Analyzing: ' + file.name;
  modal.appendChild(desc);
  
  var progress = el('div');
  progress.style.cssText = 'height:4px;background:#e5e7eb;border-radius:2px;overflow:hidden;margin-bottom:20px';
  var bar = el('div');
  bar.style.cssText = 'height:100%;background:#bf1122;width:0%;transition:width 0.3s';
  progress.appendChild(bar);
  modal.appendChild(progress);
  
  var status = el('div');
  status.style.cssText = 'color:#6b7280;font-size:14px';
  status.textContent = 'Extracting audio...';
  modal.appendChild(status);
  
  overlay.appendChild(modal);
  document.body.appendChild(overlay);
  
  // Simulate AI processing (in real app, this would call Anthropic API)
  var steps = [
    {pct: 20, text: 'Transcribing audio...'},
    {pct: 40, text: 'Identifying speakers...'},
    {pct: 60, text: 'Extracting key points...'},
    {pct: 80, text: 'Generating summary...'},
    {pct: 100, text: 'Complete!'}
  ];
  
  var currentStep = 0;
  var interval = setInterval(function() {
    if (currentStep >= steps.length) {
      clearInterval(interval);
      
      // Generate sample data
      var sampleData = generateMeetingSummary(file.name);
      
      // Update state
      if (!state.project.targets.meeting_validated) {
        state.project.targets.meeting_validated = true;
      }
      if (!state.project.targets.key_agreements) {
        state.project.targets.key_agreements = sampleData.agreements.join('\n');
      }
      if (!state.project.targets.open_points) {
        state.project.targets.open_points = sampleData.openPoints.join('\n');
      }
      
      setTimeout(function() {
        document.body.removeChild(overlay);
        showStep('perf'); // Refresh
        alert('‚úì Meeting analysis complete!\n\n' + 
              sampleData.agreements.length + ' Key Agreements\n' +
              sampleData.openPoints.length + ' Open Points\n\n' +
              'Review and edit the results below.');
        autosave();
      }, 500);
      return;
    }
    
    var step = steps[currentStep];
    bar.style.width = step.pct + '%';
    status.textContent = step.text;
    currentStep++;
  }, 800);
}

function generateMeetingSummary(filename) {
  // Sample AI-generated content (in real app, this comes from Claude API)
  return {
    agreements: [
      '‚Ä¢ Client confirmed requirement for 90,000 CFM dust collection system',
      '‚Ä¢ Project timeline: 16 weeks from PO to installation',
      '‚Ä¢ Budget approved: Option A (Minimum CAPEX approach)',
      '‚Ä¢ Weekly progress meetings scheduled every Thursday at 2pm'
    ],
    openPoints: [
      '‚Ä¢ Pending: 3D scan of existing facility (Client to provide by Dec 20)',
      '‚Ä¢ TBD: Electrical service upgrade requirements',
      '‚Ä¢ Review: Filter material selection (Polyester vs PTFE)',
      '‚Ä¢ Confirm: Installation access hours and restrictions'
    ]
  };
}

function showStep(id) {
  activateTab(id);
  currentTab = id;
  computeProgress();
  autosave();
  
  // Show/hide sidebar based on step
  var sidebar = $('#equipSidebar');
  var mainElem = document.querySelector('main');
  if (sidebar && mainElem) {
    if (id === 'opts') {
      sidebar.classList.add('active');
      mainElem.classList.add('with-sidebar');
      paintOptionEquipList();
    } else {
      sidebar.classList.remove('active');
      mainElem.classList.remove('with-sidebar');
    }
  }
  
  var box = $('#stepContainer');
  box.innerHTML = '';
  
  // Always update progress when switching steps
  setTimeout(function() {
    computeProgress();
  }, 50);
  
  if (id === 'project') return renderProject(box);
  if (id === 'site') return renderSite(box);
  if (id === 'perf') return renderPerf(box);
  if (id === 'opts') return renderOpts(box);
  if (id === 'cost') return renderCost(box);
  if (id === 'contract') return renderContract(box);
  if (id === 'preview') return renderPreview(box);
  if (id === 'equip') return renderEquip(box);
}

function renderProject(box) {
  var title = el('h2');
  title.textContent = T[LANG].project;
  box.appendChild(title);
  
  box.appendChild(formGrid([
    field({label: T[LANG].projectName, type: 'text', req: true, w: 'f3'}, 'project.header.project_name'),
    field({label: T[LANG].clientName, type: 'text', req: true, w: 'f3'}, 'project.header.client'),
    field({label: T[LANG].quoteId, type: 'text', req: true, w: 'f2'}, 'project.header.quote_id'),
    field({label: T[LANG].revision, type: 'text', req: true, w: 'f2'}, 'project.header.rev')
  ]));
  
  box.appendChild(formGrid([
    field({label: T[LANG].preparedBy, type: 'text', w: 'f2'}, 'project.header.prepared_by'),
    field({label: T[LANG].approvedBy, type: 'text', w: 'f2'}, 'project.header.approved_by'),
    field({label: T[LANG].validityDate, type: 'text', w: 'f2'}, 'project.header.validity_date'),
    field({label: T[LANG].clientRef, type: 'text', w: 'f2'}, 'project.header.client_ref')
  ]));
  
  box.appendChild(formGrid([
    field({label: T[LANG].ndaInPlace, type: 'select', w: 'f2', opts: ['', 'No', 'Yes']}, 'project.header.nda'),
    field({label: T[LANG].siteLocation, type: 'text', w: 'f4'}, 'project.header.site_location')
  ]));
  
  
  // Documents & Notes Section
  var docCard = el('div', 'card');
  docCard.style.marginTop = '20px';
  
  var docTitle = el('h3');
  docTitle.textContent = T[LANG].documents;
  docCard.appendChild(docTitle);
  
  // Upload section
  var uploadSection = el('div');
  uploadSection.style.cssText = 'display:flex;gap:10px;align-items:end;margin-bottom:16px;padding:12px;background:#f8f9fa;border-radius:8px';
  
  var fileInputWrapper = el('div');
  fileInputWrapper.style.flex = '1';
  
  // Hidden file input
  var fileInput = el('input');
  fileInput.type = 'file';
  fileInput.id = 'hiddenFileInput';
  fileInput.accept = '.pdf,.eml,.msg,.txt,.mp3,.wav,.m4a,.doc,.docx';
  fileInput.style.display = 'none';
  fileInputWrapper.appendChild(fileInput);
  
  // Custom file button
  var customFileBtn = el('button', 'btn');
  customFileBtn.type = 'button';
  customFileBtn.style.cssText = 'width:100%;padding:10px;text-align:left;background:#fff;border:2px dashed #ddd;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:8px';
  customFileBtn.innerHTML = '<span style="font-size:20px">üìé</span><span id="fileNameDisplay" style="flex:1;color:#666">Click to select file...</span>';
  
  customFileBtn.onclick = function() {
    fileInput.click();
  };
  
  fileInput.onchange = function() {
    var display = document.getElementById('fileNameDisplay');
    if (fileInput.files && fileInput.files.length > 0) {
      display.textContent = fileInput.files[0].name;
      display.style.color = '#000';
    } else {
      display.textContent = 'Click to select file...';
      display.style.color = '#666';
    }
  };
  
  fileInputWrapper.appendChild(customFileBtn);
  uploadSection.appendChild(fileInputWrapper);
  
  var typeWrapper = el('div');
  typeWrapper.style.width = '150px';
  var typeLabel = el('label');
  typeLabel.textContent = T[LANG].docType;
  typeLabel.style.display = 'block';
  typeLabel.style.marginBottom = '4px';
  typeLabel.style.fontSize = '12px';
  typeLabel.style.color = '#666';
  typeWrapper.appendChild(typeLabel);
  
  var typeSelect = el('select');
  typeSelect.style.cssText = 'width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;background:#fff';
  typeSelect.innerHTML = '<option value="Internal">' + T[LANG].internal + '</option><option value="Customer">' + T[LANG].customer + '</option>';
  typeWrapper.appendChild(typeSelect);
  uploadSection.appendChild(typeWrapper);
  
  var uploadBtn = el('button', 'btn pri');
  uploadBtn.textContent = 'üìé ' + T[LANG].uploadDocument;
  uploadBtn.style.height = '38px';
  uploadBtn.onclick = function() {
    if (!fileInput.files || fileInput.files.length === 0) {
      alert('Please select a file first');
      return;
    }
    
    var file = fileInput.files[0];
    var docType = typeSelect.value;
    
    // Read file
    var reader = new FileReader();
    reader.onload = function(e) {
      if (!state.project.header.documents) {
        state.project.header.documents = [];
      }
      
      state.project.header.documents.push({
        id: uid('DOC'),
        name: file.name,
        type: docType,
        size: file.size,
        uploadDate: new Date().toISOString(),
        content: e.target.result,
        summary: ''
      });
      
      fileInput.value = '';
      renderDocumentList();
      autosave();
    };
    
    // Read as data URL for all file types
    reader.readAsDataURL(file);
  };
  uploadSection.appendChild(uploadBtn);
  
  docCard.appendChild(uploadSection);
  
  // Document list
  var docListContainer = el('div');
  docListContainer.id = 'documentList';
  docCard.appendChild(docListContainer);
  
  function renderDocumentList() {
    var listContainer = document.getElementById('documentList');
    if (!listContainer) return;
    
    listContainer.innerHTML = '';
    
    var docs = state.project.header.documents || [];
    
    if (docs.length === 0) {
      var emptyMsg = el('div', 'note');
      emptyMsg.textContent = T[LANG].noDocuments;
      listContainer.appendChild(emptyMsg);
      return;
    }
    
    for (var i = 0; i < docs.length; i++) {
      var doc = docs[i];
      var docItem = el('div');
      docItem.style.cssText = 'border:1px solid #ddd;border-radius:8px;padding:12px;margin-bottom:10px;background:#fff';
      
      // Header
      var docHeader = el('div');
      docHeader.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:8px';
      
      var docInfo = el('div');
      docInfo.style.flex = '1';
      
      var docNameSpan = el('div');
      docNameSpan.style.cssText = 'font-weight:600;color:#003361';
      var icon = doc.name.endsWith('.pdf') ? 'üìÑ' : 
                 doc.name.endsWith('.mp3') || doc.name.endsWith('.wav') ? 'üé§' : 
                 doc.name.endsWith('.eml') || doc.name.endsWith('.msg') ? 'üìß' : 'üìù';
      docNameSpan.textContent = icon + ' ' + doc.name;
      docInfo.appendChild(docNameSpan);
      
      var docMeta = el('div', 'small');
      docMeta.style.color = '#666';
      var badge = el('span');
      badge.style.cssText = 'display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;margin-right:8px;background:' + 
        (doc.type === 'Internal' ? '#eff6ff;color:#1e40af' : '#f0fdf4;color:#15803d');
      badge.textContent = doc.type;
      docMeta.appendChild(badge);
      docMeta.appendChild(document.createTextNode((doc.size / 1024).toFixed(1) + ' KB ‚Ä¢ ' + new Date(doc.uploadDate).toLocaleDateString()));
      docInfo.appendChild(docMeta);
      
      docHeader.appendChild(docInfo);
      
      var btnGroup = el('div');
      btnGroup.style.cssText = 'display:flex;gap:6px';
      
      var summaryBtn = el('button', 'btn');
      summaryBtn.innerHTML = '‚ú® ' + T[LANG].aiSummary;
      summaryBtn.style.fontSize = '12px';
      summaryBtn.onclick = (function(idx) {
        return function() {
          generateAISummary(idx);
        };
      })(i);
      btnGroup.appendChild(summaryBtn);
      
      var delBtn = el('button', 'btn dan');
      delBtn.textContent = '‚úï';
      delBtn.style.padding = '4px 10px';
      delBtn.onclick = (function(idx) {
        return function() {
          if (confirm('Delete this document?')) {
            state.project.header.documents.splice(idx, 1);
            renderDocumentList();
            autosave();
          }
        };
      })(i);
      btnGroup.appendChild(delBtn);
      
      docHeader.appendChild(btnGroup);
      docItem.appendChild(docHeader);
      
      // Summary
      if (doc.summary) {
        var summaryDiv = el('div');
        summaryDiv.style.cssText = 'background:#f8f9fa;border-left:3px solid #003361;padding:10px;border-radius:4px;margin-top:8px';
        var summaryTitle = el('div', 'small');
        summaryTitle.style.cssText = 'font-weight:600;margin-bottom:4px;color:#003361';
        summaryTitle.textContent = 'AI Summary:';
        summaryDiv.appendChild(summaryTitle);
        var summaryText = el('div', 'small');
        summaryText.textContent = doc.summary;
        summaryDiv.appendChild(summaryText);
        docItem.appendChild(summaryDiv);
      }
      
      listContainer.appendChild(docItem);
    }
  }
  
  renderDocumentList();
  box.appendChild(docCard);
}

function renderSite(box) {
  var title = el('h2');
  title.textContent = T[LANG].site;
  box.appendChild(title);
  
  box.appendChild(formGrid([
    field({label: T[LANG].installContext, type: 'select', w: 'f2', opts: ['', 'Indoor', 'Outdoor', 'Roof', 'Yard']}, 'project.site.install'),
    field({label: T[LANG].ambientTmin, type: 'number', w: 'f1'}, 'project.site.ambient_min'),
    field({label: T[LANG].ambientTmax, type: 'number', w: 'f1'}, 'project.site.ambient_max'),
    field({label: T[LANG].explosionClass, type: 'select', w: 'f2', opts: ['', 'None', 'ATEX 21', 'ATEX 22', 'NFPA Class II, Div 1']}, 'project.site.explosion'),
    field({label: T[LANG].voltageService, type: 'text', w: 'f2'}, 'project.site.voltage')
  ]));
  
  box.appendChild(formGrid([
    field({label: T[LANG].emissionLimit, type: 'number', w: 'f1'}, 'project.site.emission_mgNm3'),
    field({label: T[LANG].noiseLimit, type: 'number', w: 'f1'}, 'project.site.noise_dBA'),
    field({label: T[LANG].floorArea, type: 'number', w: 'f1'}, 'project.site.floor_area_m2'),
    field({label: T[LANG].headroom, type: 'number', w: 'f1'}, 'project.site.headroom_m')
  ]));
  
  var accessCard = el('div', 'card');
  var accessTitle = el('h3');
  accessTitle.textContent = T[LANG].accessHandling;
  accessCard.appendChild(accessTitle);
  
  var checkGroup = el('div', 'checkbox-group');
  for (var i = 0; i < ACCESS_OPTIONS.length; i++) {
    var item = el('div', 'checkbox-item');
    var cb = el('input');
    cb.type = 'checkbox';
    var opt = ACCESS_OPTIONS[i];
    cb.checked = (state.project.site.access_handling || []).indexOf(opt) >= 0;
    cb.onclick = (function(option) {
      return function(e) {
        if (!state.project.site.access_handling) state.project.site.access_handling = [];
        var idx = state.project.site.access_handling.indexOf(option);
        if (e.target.checked && idx < 0) {
          state.project.site.access_handling.push(option);
        } else if (!e.target.checked && idx >= 0) {
          state.project.site.access_handling.splice(idx, 1);
        }
        autosave();
      };
    })(opt);
    var lbl = el('label');
    lbl.textContent = opt;
    item.appendChild(cb);
    item.appendChild(lbl);
    checkGroup.appendChild(item);
  }
  accessCard.appendChild(checkGroup);
  box.appendChild(accessCard);
  
  // Site Files Section (Photos, Drawings, Voice Notes)
  var filesCard = el('div', 'card');
  filesCard.style.marginTop = '20px';
  
  var filesTitle = el('h3');
  filesTitle.textContent = T[LANG].siteFiles;
  filesCard.appendChild(filesTitle);
  
  // Upload section
  var uploadSection = el('div');
  uploadSection.style.cssText = 'display:flex;gap:10px;align-items:end;margin-bottom:16px;padding:12px;background:#f8f9fa;border-radius:8px';
  
  var fileInputWrapper = el('div');
  fileInputWrapper.style.flex = '1';
  
  var siteFileInput = el('input');
  siteFileInput.type = 'file';
  siteFileInput.id = 'siteFileInput';
  siteFileInput.accept = 'image/*,.pdf,.dwg,.dxf,.mp3,.wav,.m4a,.txt';
  siteFileInput.style.display = 'none';
  fileInputWrapper.appendChild(siteFileInput);
  
  var customSiteFileBtn = el('button', 'btn');
  customSiteFileBtn.type = 'button';
  customSiteFileBtn.style.cssText = 'width:100%;padding:10px;text-align:left;background:#fff;border:2px dashed #ddd;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:8px';
  customSiteFileBtn.innerHTML = '<span style="font-size:20px">üìé</span><span id="siteFileNameDisplay" style="flex:1;color:#666">' + T[LANG].selectFile + '</span>';
  
  customSiteFileBtn.onclick = function() {
    siteFileInput.click();
  };
  
  siteFileInput.onchange = function() {
    var display = document.getElementById('siteFileNameDisplay');
    if (siteFileInput.files && siteFileInput.files.length > 0) {
      display.textContent = siteFileInput.files[0].name;
      display.style.color = '#000';
    } else {
      display.textContent = T[LANG].selectFile;
      display.style.color = '#666';
    }
  };
  
  fileInputWrapper.appendChild(customSiteFileBtn);
  uploadSection.appendChild(fileInputWrapper);
  
  var uploadSiteBtn = el('button', 'btn pri');
  uploadSiteBtn.textContent = 'üìé ' + T[LANG].uploadFile;
  uploadSiteBtn.style.height = '38px';
  uploadSiteBtn.onclick = function() {
    if (!siteFileInput.files || siteFileInput.files.length === 0) {
      alert('Please select a file first');
      return;
    }
    
    var file = siteFileInput.files[0];
    
    var reader = new FileReader();
    reader.onload = function(e) {
      if (!state.project.site.site_files) {
        state.project.site.site_files = [];
      }
      
      var fileType = 'Other';
      if (file.type.startsWith('image/')) fileType = 'Photo';
      else if (file.type === 'application/pdf') fileType = 'PDF';
      else if (file.name.match(/\.(dwg|dxf)$/i)) fileType = 'Drawing';
      else if (file.type.startsWith('audio/')) fileType = 'Audio';
      
      state.project.site.site_files.push({
        id: uid('FILE'),
        name: file.name,
        type: fileType,
        size: file.size,
        uploadDate: new Date().toISOString(),
        content: e.target.result,
        note: ''
      });
      
      siteFileInput.value = '';
      var display = document.getElementById('siteFileNameDisplay');
      if (display) {
        display.textContent = T[LANG].selectFile;
        display.style.color = '#666';
      }
      renderSiteFileList();
      autosave();
    };
    
    reader.readAsDataURL(file);
  };
  uploadSection.appendChild(uploadSiteBtn);
  
  filesCard.appendChild(uploadSection);
  
  // File list
  var fileListContainer = el('div');
  fileListContainer.id = 'siteFileList';
  filesCard.appendChild(fileListContainer);
  
  function renderSiteFileList() {
    var listContainer = document.getElementById('siteFileList');
    if (!listContainer) return;
    
    listContainer.innerHTML = '';
    
    var files = state.project.site.site_files || [];
    
    if (files.length === 0) {
      var emptyMsg = el('div', 'note');
      emptyMsg.textContent = 'No files uploaded yet';
      listContainer.appendChild(emptyMsg);
      return;
    }
    
    for (var i = 0; i < files.length; i++) {
      var file = files[i];
      var fileItem = el('div');
      fileItem.style.cssText = 'border:1px solid #ddd;border-radius:8px;padding:12px;margin-bottom:10px;background:#fff';
      
      var fileHeader = el('div');
      fileHeader.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:8px';
      
      var fileInfo = el('div');
      fileInfo.style.flex = '1';
      
      var fileNameSpan = el('div');
      fileNameSpan.style.cssText = 'font-weight:600;color:#003361';
      var icon = file.type === 'Photo' ? 'üì∑' : 
                 file.type === 'Drawing' ? 'üìê' : 
                 file.type === 'Audio' ? 'üé§' : 
                 file.type === 'PDF' ? 'üìÑ' : 'üìé';
      fileNameSpan.textContent = icon + ' ' + file.name;
      fileInfo.appendChild(fileNameSpan);
      
      var fileMeta = el('div', 'small');
      fileMeta.style.color = '#666';
      var typeBadge = el('span');
      typeBadge.style.cssText = 'display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;margin-right:8px;background:#eff6ff;color:#1e40af';
      typeBadge.textContent = file.type;
      fileMeta.appendChild(typeBadge);
      fileMeta.appendChild(document.createTextNode((file.size / 1024).toFixed(1) + ' KB ‚Ä¢ ' + new Date(file.uploadDate).toLocaleDateString()));
      fileInfo.appendChild(fileMeta);
      
      fileHeader.appendChild(fileInfo);
      
      var btnGroup = el('div');
      btnGroup.style.cssText = 'display:flex;gap:6px';
      
      if (file.type === 'Photo' && file.content) {
        var viewBtn = el('button', 'btn');
        viewBtn.innerHTML = 'üëÅÔ∏è View';
        viewBtn.style.fontSize = '12px';
        viewBtn.onclick = (function(fileContent) {
          return function() {
            var modal = el('div');
            modal.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:2000;display:flex;align-items:center;justify-content:center;cursor:pointer';
            var img = el('img');
            img.src = fileContent;
            img.style.cssText = 'max-width:90%;max-height:90%;border-radius:8px';
            modal.appendChild(img);
            modal.onclick = function() {
              document.body.removeChild(modal);
            };
            document.body.appendChild(modal);
          };
        })(file.content);
        btnGroup.appendChild(viewBtn);
      }
      
      var delBtn = el('button', 'btn dan');
      delBtn.textContent = '‚úï';
      delBtn.style.padding = '4px 10px';
      delBtn.onclick = (function(idx) {
        return function() {
          if (confirm('Delete this file?')) {
            state.project.site.site_files.splice(idx, 1);
            renderSiteFileList();
            autosave();
          }
        };
      })(i);
      btnGroup.appendChild(delBtn);
      
      fileHeader.appendChild(btnGroup);
      fileItem.appendChild(fileHeader);
      
      // Note input
      var noteInput = el('textarea');
      noteInput.placeholder = 'Add a note about this file...';
      noteInput.value = file.note || '';
      noteInput.style.cssText = 'width:100%;padding:6px;border:1px solid #ddd;border-radius:4px;font-size:12px;min-height:50px;margin-top:8px';
      noteInput.oninput = (function(idx) {
        return function() {
          state.project.site.site_files[idx].note = this.value;
          autosave();
        };
      })(i);
      fileItem.appendChild(noteInput);
      
      listContainer.appendChild(fileItem);
    }
  }
  
  renderSiteFileList();
  box.appendChild(filesCard);
}

function renderPerf(box) {
  var title = el('h2');
  title.textContent = T[LANG].perf;
  box.appendChild(title);
  
  var phase1 = el('div', 'phase-section');
  var p1header = el('div', 'phase-header');
  p1header.innerHTML = '<div class="phase-number">1</div><div class="phase-title">' + T[LANG].phase1 + '</div>';
  phase1.appendChild(p1header);
  
  var reviewCard = el('div', 'card');
  var reviewTitle = el('h3');
  reviewTitle.textContent = T[LANG].siteReview;
  reviewCard.appendChild(reviewTitle);
  
  var summary = el('div');
  var s = state.project.site;
  summary.innerHTML = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:10px;background:#f8f9fa;border-radius:6px">' +
    '<div class="small"><b>Install Context:</b> ' + s.install + '</div>' +
    '<div class="small"><b>Temperature:</b> ' + s.ambient_min + '¬∞C to ' + s.ambient_max + '¬∞C</div>' +
    '<div class="small"><b>Explosion Class:</b> ' + s.explosion + '</div>' +
    '<div class="small"><b>Voltage:</b> ' + s.voltage + '</div>' +
    '<div class="small"><b>Utilities:</b> ' + (s.utilities || '-') + '</div>' +
    '<div class="small"><b>Emission Limit:</b> ' + (s.emission_mgNm3 || '-') + ' mg/Nm¬≥</div>' +
    '<div class="small"><b>Noise Limit:</b> ' + (s.noise_dBA || '-') + ' dBA</div>' +
    '<div class="small"><b>Floor Area:</b> ' + (s.floor_area_m2 || '-') + ' m¬≤</div>' +
    '<div class="small"><b>Headroom:</b> ' + (s.headroom_m || '-') + ' m</div>' +
    '<div class="small" style="grid-column:1/-1"><b>Access / Handling:</b> ' + ((s.access_handling || []).join(', ') || 'Not specified') + '</div>' +
    '<div class="small" style="grid-column:1/-1"><b>Engineer Notes:</b> ' + ((s.engineer_notes && s.engineer_notes.length) || 0) + ' entries</div>' +
    '</div>';
  reviewCard.appendChild(summary);
  
  var statusSel = el('div', 'status-selector');
  var statuses = ['confirm', 'pending', 'revisit'];
  for (var i = 0; i < statuses.length; i++) {
    var opt = el('div', 'status-option');
    var s = statuses[i];
    opt.textContent = T[LANG][s];
    if (state.project.targets.site_review_status === s) opt.classList.add('selected');
    opt.onclick = (function(status) {
      return function() {
        state.project.targets.site_review_status = status;
        showStep('perf');
        autosave();
      };
    })(s);
    statusSel.appendChild(opt);
  }
  reviewCard.appendChild(statusSel);
  
  var commentsTA = el('textarea');
  commentsTA.placeholder = 'Review comments...';
  commentsTA.value = state.project.targets.site_review_comments || '';
  commentsTA.oninput = function() {
    state.project.targets.site_review_comments = commentsTA.value;
    autosave();
  };
  reviewCard.appendChild(commentsTA);
  
  phase1.appendChild(reviewCard);
  box.appendChild(phase1);
  
  var phase2 = el('div', 'phase-section');
  var p2header = el('div', 'phase-header');
  p2header.innerHTML = '<div class="phase-number">2</div><div class="phase-title">' + T[LANG].phase2 + '</div>';
  phase2.appendChild(p2header);
  
  {
    // Upload section
    var uploadCard = el('div');
    uploadCard.style.cssText = 'background:#fff;border:2px solid #d1d5db;border-radius:8px;padding:20px;margin-bottom:20px';
    
    var uploadHeader = el('div');
    uploadHeader.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:15px';
    
    var uploadTitle = el('h4');
    uploadTitle.style.cssText = 'margin:0;color:#003361';
    uploadTitle.textContent = 'üéôÔ∏è Meeting File Upload';
    uploadHeader.appendChild(uploadTitle);
    
    var uploadBtn = el('button');
    uploadBtn.className = 'btn pri';
    uploadBtn.style.cssText = 'padding:8px 16px';
    uploadBtn.innerHTML = 'üì§ Upload Meeting File';
    uploadBtn.onclick = function() {
      var input = document.createElement('input');
      input.type = 'file';
      input.accept = 'audio/*,video/*,.mp3,.mp4,.wav,.m4a';
      input.onchange = function(e) {
        if (e.target.files.length > 0) {
          handleMeetingFileUpload(e.target.files[0]);
        }
      };
      input.click();
    };
    uploadHeader.appendChild(uploadBtn);
    uploadCard.appendChild(uploadHeader);
    
    var uploadNote = el('div');
    uploadNote.style.cssText = 'background:#e6f2ff;border-left:4px solid #003361;padding:12px;border-radius:4px';
    uploadNote.innerHTML = '<div style="font-size:12px;color:#003361;line-height:1.5">' +
      '<b>AI Meeting Analysis:</b><br>' +
      'Upload audio/video file (MP3, MP4, WAV) ‚Üí AI automatically extracts Key Agreements, Open Points, and Action Items ‚Üí Review and edit manually' +
      '</div>';
    uploadCard.appendChild(uploadNote);
    phase2.appendChild(uploadCard);
    
    // Key Agreements
    var keyCard = el('div');
    keyCard.style.cssText = 'margin-bottom:20px';
    
    var keyHeader = el('div');
    keyHeader.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:8px';
    
    var keyLabel = el('label');
    keyLabel.textContent = T[LANG].keyAgreements;
    keyLabel.style.cssText = 'font-weight:600;color:#003361;font-size:14px';
    keyHeader.appendChild(keyLabel);
    
    var keyBtnGroup = el('div');
    keyBtnGroup.style.cssText = 'display:flex;gap:4px';
    
    var addKeyBtn = el('button');
    addKeyBtn.className = 'btn-sm';
    addKeyBtn.style.cssText = 'background:#10b981;color:#fff;border:none;padding:4px 8px;font-size:11px;border-radius:4px';
    addKeyBtn.textContent = '+ Add Item';
    addKeyBtn.onclick = function() {
      var current = state.project.targets.key_agreements || '';
      var newItem = '‚Ä¢ ';
      state.project.targets.key_agreements = current + (current ? '\n' : '') + newItem;
      showStep('perf');
    };
    keyBtnGroup.appendChild(addKeyBtn);
    
    var clearKeyBtn = el('button');
    clearKeyBtn.className = 'btn-sm';
    clearKeyBtn.style.cssText = 'background:#ef4444;color:#fff;border:none;padding:4px 8px;font-size:11px;border-radius:4px';
    clearKeyBtn.textContent = 'Clear';
    clearKeyBtn.onclick = function() {
      if (confirm('Clear all key agreements?')) {
        state.project.targets.key_agreements = '';
        showStep('perf');
      }
    };
    keyBtnGroup.appendChild(clearKeyBtn);
    
    keyHeader.appendChild(keyBtnGroup);
    keyCard.appendChild(keyHeader);
    
    var keyTA = el('textarea');
    keyTA.rows = 5;
    keyTA.placeholder = 'Enter key agreements...\nExample:\n‚Ä¢ Client confirmed budget of $500K\n‚Ä¢ Timeline: 16 weeks from PO\n‚Ä¢ Weekly progress meetings on Thursdays';
    keyTA.value = state.project.targets.key_agreements || '';
    keyTA.style.cssText = 'width:100%;padding:10px;border:2px solid #d1d5db;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical';
    keyTA.oninput = function() {
      state.project.targets.key_agreements = keyTA.value;
      autosave();
    };
    keyCard.appendChild(keyTA);
    phase2.appendChild(keyCard);
    
    // Open Points
    var openCard = el('div');
    openCard.style.cssText = 'margin-bottom:20px';
    
    var openHeader = el('div');
    openHeader.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:8px';
    
    var openLabel = el('label');
    openLabel.textContent = T[LANG].openPoints;
    openLabel.style.cssText = 'font-weight:600;color:#003361;font-size:14px';
    openHeader.appendChild(openLabel);
    
    var openBtnGroup = el('div');
    openBtnGroup.style.cssText = 'display:flex;gap:4px';
    
    var addOpenBtn = el('button');
    addOpenBtn.className = 'btn-sm';
    addOpenBtn.style.cssText = 'background:#10b981;color:#fff;border:none;padding:4px 8px;font-size:11px;border-radius:4px';
    addOpenBtn.textContent = '+ Add Item';
    addOpenBtn.onclick = function() {
      var current = state.project.targets.open_points || '';
      var newItem = '‚Ä¢ ';
      state.project.targets.open_points = current + (current ? '\n' : '') + newItem;
      showStep('perf');
    };
    openBtnGroup.appendChild(addOpenBtn);
    
    var clearOpenBtn = el('button');
    clearOpenBtn.className = 'btn-sm';
    clearOpenBtn.style.cssText = 'background:#ef4444;color:#fff;border:none;padding:4px 8px;font-size:11px;border-radius:4px';
    clearOpenBtn.textContent = 'Clear';
    clearOpenBtn.onclick = function() {
      if (confirm('Clear all open points?')) {
        state.project.targets.open_points = '';
        showStep('perf');
      }
    };
    openBtnGroup.appendChild(clearOpenBtn);
    
    openHeader.appendChild(openBtnGroup);
    openCard.appendChild(openHeader);
    
    var openTA = el('textarea');
    openTA.rows = 5;
    openTA.placeholder = 'Enter open points...\nExample:\n‚Ä¢ Pending: 3D facility scan (due Dec 20)\n‚Ä¢ TBD: Electrical service requirements\n‚Ä¢ Review: Filter material selection';
    openTA.value = state.project.targets.open_points || '';
    openTA.style.cssText = 'width:100%;padding:10px;border:2px solid #d1d5db;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical';
    openTA.oninput = function() {
      state.project.targets.open_points = openTA.value;
      autosave();
    };
    openCard.appendChild(openTA);
    phase2.appendChild(openCard);
    
    // Action Items
    var actionCard = el('div');
    actionCard.style.cssText = 'margin-bottom:20px';
    
    var actionHeader = el('div');
    actionHeader.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:8px';
    
    var actionLabel = el('label');
    actionLabel.textContent = T[LANG].actionItems;
    actionLabel.style.cssText = 'font-weight:600;color:#003361;font-size:14px';
    actionHeader.appendChild(actionLabel);
    
    var actionBtnGroup = el('div');
    actionBtnGroup.style.cssText = 'display:flex;gap:4px';
    
    var addActionBtn = el('button');
    addActionBtn.className = 'btn-sm';
    addActionBtn.style.cssText = 'background:#10b981;color:#fff;border:none;padding:4px 8px;font-size:11px;border-radius:4px';
    addActionBtn.textContent = '+ Add Item';
    addActionBtn.onclick = function() {
      var current = state.project.targets.action_items || '';
      var newItem = '‚Ä¢ ';
      state.project.targets.action_items = current + (current ? '\n' : '') + newItem;
      showStep('perf');
    };
    actionBtnGroup.appendChild(addActionBtn);
    
    var clearActionBtn = el('button');
    clearActionBtn.className = 'btn-sm';
    clearActionBtn.style.cssText = 'background:#ef4444;color:#fff;border:none;padding:4px 8px;font-size:11px;border-radius:4px';
    clearActionBtn.textContent = 'Clear';
    clearActionBtn.onclick = function() {
      if (confirm('Clear all action items?')) {
        state.project.targets.action_items = '';
        showStep('perf');
      }
    };
    actionBtnGroup.appendChild(clearActionBtn);
    
    actionHeader.appendChild(actionBtnGroup);
    actionCard.appendChild(actionHeader);
    
    var actionTA = el('textarea');
    actionTA.rows = 5;
    actionTA.placeholder = 'Enter action items...\nExample:\n‚Ä¢ Client to provide 3D scan by Dec 20\n‚Ä¢ Engineering to review filter specs\n‚Ä¢ Schedule site visit for Jan 5';
    actionTA.value = state.project.targets.action_items || '';
    actionTA.style.cssText = 'width:100%;padding:10px;border:2px solid #d1d5db;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical';
    actionTA.oninput = function() {
      state.project.targets.action_items = actionTA.value;
      autosave();
    };
    actionCard.appendChild(actionTA);
    phase2.appendChild(actionCard);
    
    // Bottom fields grid
    phase2.appendChild(formGrid([
      field({label: T[LANG].decisionDate, type: 'text', w: 'f2'}, 'project.targets.decision_date'),
      field({label: T[LANG].validationStatus, type: 'select', w: 'f2', opts: ['Confirmed', 'Pending', 'Proposal Only']}, 'project.targets.validation_status'),
      field({label: T[LANG].meetingRefId, type: 'text', w: 'f2'}, 'project.targets.meeting_ref_id')
    ]));
    
    phase2.appendChild(formGrid([
      field({label: T[LANG].meetingSummary, type: 'textarea', w: 'f4'}, 'project.targets.meeting_summary')
    ]));
    
    var validateBtn = el('button', 'btn pri');
    validateBtn.textContent = '‚úì Validate Meeting Outcome';
    validateBtn.onclick = function() {
      state.project.targets.meeting_validated = true;
      computeProgress();
      showStep('perf');
      autosave();
    };
    phase2.appendChild(validateBtn);
    
    if (state.project.targets.meeting_validated) {
      var gate = el('div', 'validation-gate passed');
      gate.textContent = '‚úì Meeting outcome validated.';
      phase2.appendChild(gate);
    } else {
      var gate = el('div', 'validation-gate');
      gate.textContent = 'üí° Recommended: Click "Validate Meeting Outcome" before proceeding to Phase 3';
      phase2.appendChild(gate);
    }
  }
  box.appendChild(phase2);
  
  var phase3 = el('div', 'phase-section');
  var p3header = el('div', 'phase-header');
  p3header.innerHTML = '<div class="phase-number">3</div><div class="phase-title">' + T[LANG].phase3 + '</div>';
  phase3.appendChild(p3header);
  
  {
    var globalCard = el('div', 'card');
    var globalTitle = el('h3');
    globalTitle.textContent = T[LANG].globalTargets;
    globalCard.appendChild(globalTitle);
    globalCard.appendChild(formGrid([
      field({label: T[LANG].throughput, type: 'number', w: 'f2', req: true}, 'project.targets.throughput'),
      field({label: T[LANG].availability, type: 'number', w: 'f2'}, 'project.targets.availability_pct'),
      field({label: T[LANG].deliveryTimeline, type: 'text', w: 'f2'}, 'project.targets.delivery')
    ]));
    phase3.appendChild(globalCard);
    
    var envCard = el('div', 'card');
    var envTitle = el('h3');
    envTitle.textContent = T[LANG].environmental;
    envCard.appendChild(envTitle);
    envCard.appendChild(formGrid([
      field({label: T[LANG].emission, type: 'number', w: 'f2', req: true}, 'project.targets.emission'),
      field({label: T[LANG].noise, type: 'number', w: 'f2'}, 'project.targets.noise'),
      field({label: T[LANG].regulatoryRef, type: 'text', w: 'f2'}, 'project.targets.regulatory_ref')
    ]));
    phase3.appendChild(envCard);
    
    var energyCard = el('div', 'card');
    var energyTitle = el('h3');
    energyTitle.textContent = T[LANG].energyEfficiency;
    energyCard.appendChild(energyTitle);
    energyCard.appendChild(formGrid([
      field({label: T[LANG].energyKwh, type: 'number', w: 'f2'}, 'project.targets.energy_kwh_t'),
      field({label: T[LANG].recoveryKpi, type: 'text', w: 'f2'}, 'project.targets.recovery_kpi'),
      field({label: T[LANG].utilityConstraints, type: 'text', w: 'f2'}, 'project.targets.utility_constraints')
    ]));
    phase3.appendChild(energyCard);
    
    var prioCard = el('div', 'card');
    var prioTitle = el('h3');
    prioTitle.innerHTML = T[LANG].priorityMatrix + ' ‚≠ê';
    prioCard.appendChild(prioTitle);
    var prioNote = el('div', 'small');
    prioNote.textContent = 'Drag to reorder priorities (1 = highest importance). Defines Option A/B/C design logic.';
    prioNote.style.marginBottom = '10px';
    prioCard.appendChild(prioNote);
    
    var prioList = el('div');
    prioList.style.cssText = 'display:flex;flex-direction:column;gap:6px';
    var priorities = state.project.targets.priorities || [];
    for (var i = 0; i < priorities.length; i++) {
      var prioItem = el('div');
      prioItem.style.cssText = 'display:flex;align-items:center;gap:10px;padding:10px;border:1px solid #ddd;border-radius:6px;background:#fff;cursor:move';
      prioItem.innerHTML = '<span style="color:#999;font-weight:700;font-size:18px">‚ò∞</span>' +
        '<span style="font-weight:700;color:#003361;min-width:24px">' + (i + 1) + '</span>' +
        '<span style="flex:1;font-weight:600">' + priorities[i] + '</span>';
      prioItem.draggable = true;
      prioItem.dataset.index = i;
      
      prioItem.ondragstart = function(e) {
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', e.target.dataset.index);
        e.target.style.opacity = '0.5';
      };
      prioItem.ondragend = function(e) {
        e.target.style.opacity = '1';
      };
      prioItem.ondragover = function(e) {
        e.preventDefault();
        e.target.style.borderTop = '2px solid #003361';
      };
      prioItem.ondragleave = function(e) {
        e.target.style.borderTop = '1px solid #ddd';
      };
      prioItem.ondrop = function(e) {
        e.preventDefault();
        e.target.style.borderTop = '1px solid #ddd';
        var fromIdx = parseInt(e.dataTransfer.getData('text/plain'));
        var toIdx = parseInt(e.currentTarget.dataset.index);
        if (fromIdx !== toIdx) {
          var arr = state.project.targets.priorities;
          var item = arr.splice(fromIdx, 1)[0];
          arr.splice(toIdx, 0, item);
          showStep('perf');
          autosave();
        }
      };
      
      prioList.appendChild(prioItem);
    }
    prioCard.appendChild(prioList);
    phase3.appendChild(prioCard);
    
    var overrideCard = el('div', 'card');
    var overrideTitle = el('h3');
    overrideTitle.textContent = T[LANG].equipOverrides;
    overrideCard.appendChild(overrideTitle);
    var overrideNote = el('div', 'note');
    overrideNote.innerHTML = '<div class="small" style="margin-bottom:8px"><b>Examples of equipment-specific priorities:</b></div>' +
      '<div class="small">‚Ä¢ <b>Dust Collector:</b> Emission / ŒîP priority</div>' +
      '<div class="small">‚Ä¢ <b>Conveyor:</b> Availability / Throughput priority</div>' +
      '<div class="small">‚Ä¢ <b>Dryer:</b> Moisture / Energy priority</div>' +
      '<div class="small" style="margin-top:8px;font-style:italic">Leave blank to use global targets for all equipment</div>';
    overrideCard.appendChild(overrideNote);
    
    var overrideTA = el('textarea');
    overrideTA.placeholder = 'Enter equipment-specific overrides in JSON format (optional)...';
    overrideTA.style.minHeight = '100px';
    overrideTA.style.fontFamily = 'monospace';
    overrideTA.value = JSON.stringify(state.project.targets.equipment_overrides || {}, null, 2);
    overrideTA.oninput = function() {
      try {
        state.project.targets.equipment_overrides = JSON.parse(overrideTA.value);
        overrideTA.style.borderColor = '#cfd6dd';
        autosave();
      } catch (e) {
        overrideTA.style.borderColor = '#ef4444';
      }
    };
    overrideCard.appendChild(overrideTA);
    phase3.appendChild(overrideCard);
    
    var assumCard = el('div', 'card');
    assumCard.style.cssText = 'background:#fff;border:2px solid #003361;border-radius:8px;padding:20px';
    
    var assumHeader = el('div');
    assumHeader.style.cssText = 'border-bottom:2px solid #003361;padding-bottom:12px;margin-bottom:20px';
    
    var assumTitle = el('h3');
    assumTitle.style.cssText = 'margin:0;color:#003361';
    assumTitle.textContent = 'üìã Design Basis & Assumptions';
    assumHeader.appendChild(assumTitle);
    
    var assumNote = el('div');
    assumNote.style.cssText = 'font-size:12px;color:#6b7280;margin-top:8px';
    assumNote.textContent = 'Define project scope boundaries, operating conditions, and exclusions';
    assumHeader.appendChild(assumNote);
    assumCard.appendChild(assumHeader);
    
    // Design Basis
    var basisSection = el('div');
    basisSection.style.cssText = 'margin-bottom:20px';
    
    var basisLabel = el('label');
    basisLabel.style.cssText = 'font-weight:600;color:#003361;font-size:14px;display:block;margin-bottom:8px';
    basisLabel.textContent = '1. Design Basis';
    basisSection.appendChild(basisLabel);
    
    var basisHelp = el('div');
    basisHelp.style.cssText = 'font-size:11px;color:#6b7280;margin-bottom:6px';
    basisHelp.innerHTML = '<i>Operating conditions, production rates, material properties</i>';
    basisSection.appendChild(basisHelp);
    
    var basisTA = el('textarea');
    basisTA.rows = 4;
    basisTA.placeholder = 'Example:\n‚Ä¢ Operating hours: 24/7 continuous operation\n‚Ä¢ Production rate: 10 tonnes/hour\n‚Ä¢ Material: Wood pellets, 8% moisture content\n‚Ä¢ Ambient conditions: -20¬∞C to +35¬∞C';
    basisTA.value = state.project.targets.operating_basis || '';
    basisTA.style.cssText = 'width:100%;padding:10px;border:2px solid #d1d5db;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical';
    basisTA.oninput = function() {
      state.project.targets.operating_basis = basisTA.value;
      autosave();
    };
    basisSection.appendChild(basisTA);
    assumCard.appendChild(basisSection);
    
    // Inclusions (Scope)
    var scopeSection = el('div');
    scopeSection.style.cssText = 'margin-bottom:20px';
    
    var scopeLabel = el('label');
    scopeLabel.style.cssText = 'font-weight:600;color:#003361;font-size:14px;display:block;margin-bottom:8px';
    scopeLabel.textContent = '2. Scope Inclusions';
    scopeSection.appendChild(scopeLabel);
    
    var scopeHelp = el('div');
    scopeHelp.style.cssText = 'font-size:11px;color:#6b7280;margin-bottom:6px';
    scopeHelp.innerHTML = '<i>What IS included in this quotation</i>';
    scopeSection.appendChild(scopeHelp);
    
    var scopeTA = el('textarea');
    scopeTA.rows = 4;
    scopeTA.placeholder = 'Example:\n‚Ä¢ Equipment supply and fabrication\n‚Ä¢ Engineering drawings and calculations\n‚Ä¢ Factory acceptance testing (FAT)\n‚Ä¢ Technical documentation and manuals';
    scopeTA.value = state.project.targets.scope_inclusions || '';
    scopeTA.style.cssText = 'width:100%;padding:10px;border:2px solid #d1d5db;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical';
    scopeTA.oninput = function() {
      state.project.targets.scope_inclusions = scopeTA.value;
      autosave();
    };
    scopeSection.appendChild(scopeTA);
    assumCard.appendChild(scopeSection);
    
    // Exclusions
    var exclSection = el('div');
    exclSection.style.cssText = 'margin-bottom:20px';
    
    var exclLabel = el('label');
    exclLabel.style.cssText = 'font-weight:600;color:#bf1122;font-size:14px;display:block;margin-bottom:8px';
    exclLabel.textContent = '3. Scope Exclusions';
    exclSection.appendChild(exclLabel);
    
    var exclHelp = el('div');
    exclHelp.style.cssText = 'font-size:11px;color:#6b7280;margin-bottom:6px';
    exclHelp.innerHTML = '<i>What is NOT included (client responsibility)</i>';
    exclSection.appendChild(exclHelp);
    
    var exclTA = el('textarea');
    exclTA.rows = 5;
    exclTA.placeholder = 'Example:\n‚Ä¢ Civil works and foundations\n‚Ä¢ Electrical installation and wiring\n‚Ä¢ Compressed air supply\n‚Ä¢ Site logistics and material handling\n‚Ä¢ Building modifications\n‚Ä¢ Permits and approvals';
    exclTA.value = state.project.targets.exclusions || '';
    exclTA.style.cssText = 'width:100%;padding:10px;border:2px solid #fecaca;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical;background:#fef2f2';
    exclTA.oninput = function() {
      state.project.targets.exclusions = exclTA.value;
      autosave();
    };
    exclSection.appendChild(exclTA);
    assumCard.appendChild(exclSection);
    
    // Assumptions
    var assumpSection = el('div');
    assumpSection.style.cssText = 'margin-bottom:0';
    
    var assumpLabel = el('label');
    assumpLabel.style.cssText = 'font-weight:600;color:#003361;font-size:14px;display:block;margin-bottom:8px';
    assumpLabel.textContent = '4. Project Assumptions';
    assumpSection.appendChild(assumpLabel);
    
    var assumpHelp = el('div');
    assumpHelp.style.cssText = 'font-size:11px;color:#6b7280;margin-bottom:6px';
    assumpHelp.innerHTML = '<i>Conditions assumed for this quotation</i>';
    assumpSection.appendChild(assumpHelp);
    
    var assumpTA = el('textarea');
    assumpTA.rows = 4;
    assumpTA.placeholder = 'Example:\n‚Ä¢ Client provides 3D facility scan\n‚Ä¢ Adequate electrical service available\n‚Ä¢ Site access available during installation\n‚Ä¢ Material specifications confirmed by client';
    assumpTA.value = state.project.targets.feed_variability || '';
    assumpTA.style.cssText = 'width:100%;padding:10px;border:2px solid #d1d5db;border-radius:6px;font-family:inherit;font-size:13px;resize:vertical';
    assumpTA.oninput = function() {
      state.project.targets.feed_variability = assumpTA.value;
      autosave();
    };
    assumpSection.appendChild(assumpTA);
    assumCard.appendChild(assumpSection);
    
    phase3.appendChild(assumCard);
    
    var validCard = el('div', 'card');
    var validTitle = el('h3');
    validTitle.innerHTML = T[LANG].customerValidation + ' ‚úì';
    validCard.appendChild(validTitle);
    
    var validOpts = [
      {val: 'Confirmed by Client', icon: '‚úî', color: '#22c55e'},
      {val: 'Pending Validation', icon: '‚ö†', color: '#f59e0b'},
      {val: 'Internal Proposal Only', icon: '‚ùå', color: '#64748b'}
    ];
    var validSel = el('div');
    validSel.style.cssText = 'display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap';
    for (var i = 0; i < validOpts.length; i++) {
      var vopt = el('button');
      var opt = validOpts[i];
      vopt.innerHTML = opt.icon + ' ' + opt.val;
      vopt.style.cssText = 'padding:8px 12px;border:2px solid ' + opt.color + ';border-radius:8px;cursor:pointer;background:#fff;flex:1;min-width:180px';
      if (state.project.targets.customer_validation === opt.val) {
        vopt.style.background = opt.color;
        vopt.style.color = '#fff';
        vopt.style.fontWeight = '700';
      } else {
        vopt.style.color = opt.color;
      }
      vopt.onclick = (function(val) {
        return function() {
          state.project.targets.customer_validation = val;
          showStep('perf');
          autosave();
        };
      })(opt.val);
      validSel.appendChild(vopt);
    }
    validCard.appendChild(validSel);
    
    validCard.appendChild(formGrid([
      field({label: T[LANG].validationDate, type: 'text', w: 'f2'}, 'project.targets.validation_date'),
      field({label: T[LANG].meetingRefId, type: 'text', w: 'f2'}, 'project.targets.meeting_ref_id')
    ]));
    
    validCard.appendChild(formGrid([
      field({label: T[LANG].meetingSummary, type: 'textarea', w: 'f4'}, 'project.targets.meeting_summary')
    ]));
    phase3.appendChild(validCard);
  }
  box.appendChild(phase3);
}

function renderOpts(box) {
  var title = el('h2');
  title.textContent = T[LANG].opts;
  box.appendChild(title);
  
  // Context Bar - Step 3 Summary
  
  var contextBar = el('div');
  contextBar.style.cssText = 'background:#f8f9fa;border:1px solid #ddd;border-radius:8px;padding:12px;margin-bottom:20px';
  contextBar.innerHTML = '<div style="display:flex;align-items:center;gap:15px;flex-wrap:wrap">' +
    '<div style="flex:1;min-width:200px"><div class="small">PROJECT</div><div style="font-weight:600">' + (state.project.header.project_name || '-') + '</div></div>' +
    '<div><div class="small">THROUGHPUT</div><div style="font-weight:600;color:#003361">' + (state.project.targets.throughput || '-') + ' tph</div></div>' +
    '<div><div class="small">EMISSION</div><div style="font-weight:600;color:#003361">' + (state.project.targets.emission || '-') + ' mg/Nm¬≥</div></div>' +
    '<div><div class="small">ENERGY</div><div style="font-weight:600;color:#003361">' + (state.project.targets.energy_kwh_t || '-') + ' kWh/t</div></div>' +
    '<div><div class="small">STATUS</div><div style="font-weight:600;color:#22c55e"><span style="color:#bf1122">‚úì</span> Targets Locked</div></div>' +
    '</div>';
  box.appendChild(contextBar);
  
  // Initialize options if not exists
  if (!state.options || state.options.length === 0) {
    state.options = [
      {id: 'A', type: 'Minimum CAPEX', summary: '', equipments: [], items: [], notes: '', freight: ''},
      {id: 'B', type: 'Capacity Driven', summary: '', equipments: [], items: [], notes: '', freight: ''},
      {id: 'C', type: 'Future Proof', summary: '', equipments: [], items: [], notes: '', freight: ''}
    ];
  }
  
  // Option Tabs
  var optTabs = el('div');
  optTabs.style.cssText = 'display:flex;gap:8px;margin-bottom:20px';
  for (var i = 0; i < state.options.length; i++) {
    var optTab = el('button');
    var opt = state.options[i];
    optTab.className = 'btn';
    if (state.activeOption === i) optTab.className = 'btn pri';
    optTab.innerHTML = '<b>Option ' + opt.id + '</b> ‚Äî ' + opt.type;
    optTab.onclick = (function(idx) {
      return function() {
        state.activeOption = idx;
        showStep('opts');
        paintOptionEquipList(); // Update sidebar
        autosave();
      };
    })(i);
    optTabs.appendChild(optTab);
  }
  box.appendChild(optTabs);
  
  if (state.activeOption === undefined || state.activeOption === null) {
    state.activeOption = 0;
  }
  
  var option = state.options[state.activeOption];
  if (!option) return;
  
  // Option Header
  var optHeader = el('div');
  optHeader.style.cssText = 'background:#fff;border:2px solid #003361;border-radius:10px;padding:15px;margin-bottom:15px';
  optHeader.innerHTML = '<div style="display:flex;align-items:center;gap:15px">' +
    '<div style="font-size:24px;font-weight:700;color:#003361">Option ' + option.id + '</div>' +
    '<div style="flex:1"><select id="optType" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-weight:600">' +
    '<option value="Minimum CAPEX"' + (option.type === 'Minimum CAPEX' ? ' selected' : '') + '>Minimum CAPEX ‚Äî Immediate Fix</option>' +
    '<option value="Capacity Driven"' + (option.type === 'Capacity Driven' ? ' selected' : '') + '>Capacity Driven ‚Äî Revenue Oriented</option>' +
    '<option value="Future Proof"' + (option.type === 'Future Proof' ? ' selected' : '') + '>Future Proof ‚Äî OPEX & Risk Optimized</option>' +
    '</select></div>' +
    '<div style="display:flex;gap:8px">' +
    '<div style="text-align:center;padding:8px;background:#f0fdf4;border-radius:6px"><div class="small">CAPEX</div><div style="font-weight:700">' + (option.id === 'A' ? '‚¨á' : option.id === 'B' ? '‚¨Ü' : '‚¨Ü‚¨Ü') + '</div></div>' +
    '<div style="text-align:center;padding:8px;background:#fef3c7;border-radius:6px"><div class="small">OPEX</div><div style="font-weight:700">' + (option.id === 'A' ? '=' : option.id === 'B' ? '‚¨á' : '‚¨á‚¨á') + '</div></div>' +
    '<div style="text-align:center;padding:8px;background:#fecaca;border-radius:6px"><div class="small">RISK</div><div style="font-weight:700">' + (option.id === 'A' ? '‚¨Ü' : option.id === 'B' ? '‚¨á' : '‚¨á‚¨á') + '</div></div>' +
    '</div></div>';
  box.appendChild(optHeader);
  
  document.getElementById('optType').onchange = function() {
    option.type = this.value;
    showStep('opts');
    autosave();
  };
  
  // 1. Engineering Summary
  var summaryCard = el('div', 'card');
  var summaryTitle = el('h3');
  summaryTitle.textContent = '1. ' + T[LANG].engineeringSummary;
  summaryCard.appendChild(summaryTitle);
  
  var summaryNote = el('div', 'note');
  summaryNote.innerHTML = '<b>Required:</b> Must include CAPEX, OPEX, and Risk perspective.<br>' +
    '<b>Example:</b> "This option minimizes CAPEX by reusing existing structure. OPEX remains similar to current operation. Risk is moderate due to limited capacity for future expansion."';
  summaryCard.appendChild(summaryNote);
  
  var summaryTA = el('textarea');
  summaryTA.style.minHeight = '120px';
  summaryTA.placeholder = 'Enter engineering summary (CAPEX, OPEX, Risk perspectives)...';
  summaryTA.value = option.summary || '';
  summaryTA.oninput = function() {
    option.summary = summaryTA.value;
    autosave();
  };
  summaryCard.appendChild(summaryTA);
  
  var draftBtn = el('button', 'btn');
  draftBtn.textContent = '‚ú® ' + T[LANG].autoDraft;
  draftBtn.onclick = function() {
    var draft = '';
    if (option.type === 'Minimum CAPEX') {
      draft = 'This option minimizes initial CAPEX by focusing on immediate compliance and basic functionality. ' +
        'Existing infrastructure is maximized where possible. OPEX remains at current levels. ' +
        'Risk: Limited capacity for future growth and potential for additional modifications later.';
    } else if (option.type === 'Capacity Driven') {
      draft = 'This option prioritizes production capacity and throughput to maximize revenue potential. ' +
        'CAPEX is increased to accommodate larger equipment and redundant systems. OPEX is optimized through efficient design. ' +
        'Risk: Well-balanced approach with room for moderate expansion.';
    } else {
      draft = 'This option is designed for long-term operation with maximum efficiency and lowest total cost of ownership. ' +
        'Higher initial CAPEX enables advanced automation and energy recovery systems. OPEX is minimized through efficient operation. ' +
        'Risk: Future-proof design accommodates regulatory changes and expansion needs.';
    }
    summaryTA.value = draft;
    option.summary = draft;
    autosave();
  };
  summaryCard.appendChild(draftBtn);
  box.appendChild(summaryCard);
  
  // 2. Systems & Equipments
  var sysCard = el('div', 'card');
  
  var sysHeader = el('div');
  sysHeader.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:10px';
  
  var sysTitle = el('h3');
  sysTitle.textContent = '2. ' + T[LANG].systemsEquipments + ' üîß';
  sysTitle.style.margin = '0';
  sysHeader.appendChild(sysTitle);
  sysCard.appendChild(sysHeader);
  
  var sysNote = el('div');
  sysNote.style.cssText = 'background:#e6f2ff;border-left:4px solid #003361;padding:12px;margin-bottom:16px;border-radius:4px';
  sysNote.innerHTML = '<div style="font-size:12px;color:#003361;line-height:1.5">' +
    '<b>üí° How to use:</b><br>' +
    '1. Click <b>"+ Add Equipment"</b> below<br>' +
    '2. Enter equipment name<br>' +
    '3. Select a <b>template</b> (01. AFS ~ 07. ETS) for detailed specs<br>' +
    '4. Fill in specifications - fields with <b>*</b> are required<br>' +
    '5. Template-based equipment will auto-generate BOM in Section 3' +
    '</div>';
  sysCard.appendChild(sysNote);
  
  if (!option.equipments) option.equipments = [];
  
  var eqList = el('div');
  eqList.style.cssText = 'display:flex;flex-direction:column;gap:12px;margin-bottom:10px';
  
  for (var i = 0; i < option.equipments.length; i++) {
    var eq = option.equipments[i];
    var eqCard = el('div');
    var borderColor = '#d1d5db';
    var borderWidth = '1px';
    
    // Equipment number badge
    var eqNumber = el('div');
    eqNumber.style.cssText = 'position:absolute;top:-10px;left:12px;background:#003361;color:#fff;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:700;box-shadow:0 2px 4px rgba(0,0,0,0.1)';
    eqNumber.textContent = 'Equipment ' + (i + 1);
    
    // Check for innovation/ESG badges
    if (eq.template && EQUIPMENT_TEMPLATES[eq.template]) {
      var tmpl = EQUIPMENT_TEMPLATES[eq.template];
      if (tmpl.esg) {
        borderColor = '#bf1122';
        borderWidth = '2px';
      } else if (tmpl.innovation) {
        borderColor = '#fbbf24';
        borderWidth = '2px';
      }
    }
    
    eqCard.style.cssText = 'position:relative;border:' + borderWidth + ' solid ' + borderColor + ';border-radius:8px;padding:12px;background:#fff;margin-top:14px';
    eqCard.appendChild(eqNumber);
    
    // Header row with name and actions
    var header = el('div');
    header.style.cssText = 'display:flex;align-items:center;gap:8px;margin-bottom:10px';
    
    var nameLabel = el('label');
    nameLabel.style.cssText = 'font-size:12px;font-weight:700;color:#6b7280;min-width:120px';
    nameLabel.textContent = 'Equipment Name:';
    header.appendChild(nameLabel);
    
    var nameInput = el('input');
    nameInput.type = 'text';
    nameInput.value = eq.name || '';
    nameInput.placeholder = 'e.g., Main Dust Collector, Silo #1';
    nameInput.style.cssText = 'flex:1;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-weight:600;color:#00294d';
    nameInput.oninput = (function(idx) {
      return function() {
        option.equipments[idx].name = this.value;
        autosave();
      };
    })(i);
    header.appendChild(nameInput);
    
    var delBtn = el('button');
    delBtn.className = 'btn dan';
    delBtn.textContent = '‚úï';
    delBtn.style.cssText = 'padding:6px 12px';
    delBtn.onclick = (function(idx) {
      return function() {
        if (confirm('Delete this equipment?')) {
          option.equipments.splice(idx, 1);
          showStep('opts');
          autosave();
        }
      };
    })(i);
    header.appendChild(delBtn);
    
    eqCard.appendChild(header);
    
    // Template selection row
    var templateRow = el('div');
    templateRow.style.cssText = 'display:flex;gap:8px;margin-bottom:10px;align-items:center';
    
    var templateLabel = el('label');
    templateLabel.style.cssText = 'font-size:12px;font-weight:700;color:#6b7280;min-width:120px';
    templateLabel.textContent = 'Template:';
    templateRow.appendChild(templateLabel);
    
    var templateSelect = el('select');
    templateSelect.style.cssText = 'flex:1;padding:8px;border:1px solid #d1d5db;border-radius:6px';
    
    var defaultOpt = el('option');
    defaultOpt.value = '';
    defaultOpt.textContent = '‚Äî No Template (Custom) ‚Äî';
    if (!eq.template) defaultOpt.selected = true;
    templateSelect.appendChild(defaultOpt);
    
    var templateKeys = [
      '01. AFS - Air Filtration System',
      '02. CONV - Conveyor System',
      '03. SILO - Silo Storage',
      '04. DRYER - Rotary Dryer',
      '05. GBR-DH - GBR Dryer Hopper',
      '06. SILO-DH - Silo Dryer Hopper',
      '07. ETS - Electro Thermal Stack'
    ];
    
    for (var t = 0; t < templateKeys.length; t++) {
      var opt = el('option');
      opt.value = templateKeys[t];
      opt.textContent = templateKeys[t];
      if (EQUIPMENT_TEMPLATES[templateKeys[t]].innovation) opt.textContent += ' ‚≠ê';
      if (EQUIPMENT_TEMPLATES[templateKeys[t]].esg) opt.textContent += ' üå±';
      if (eq.template === templateKeys[t]) opt.selected = true;
      templateSelect.appendChild(opt);
    }
    
    templateSelect.onchange = (function(idx) {
      return function() {
        option.equipments[idx].template = this.value;
        if (!option.equipments[idx].specs) option.equipments[idx].specs = {};
        showStep('opts');
        autosave();
      };
    })(i);
    
    templateRow.appendChild(templateSelect);
    
    var qtyLabel = el('label');
    qtyLabel.style.cssText = 'font-size:12px;font-weight:700;color:#6b7280;margin-left:8px';
    qtyLabel.textContent = 'Qty:';
    templateRow.appendChild(qtyLabel);
    
    var qtyInput = el('input');
    qtyInput.type = 'number';
    qtyInput.value = eq.qty || 1;
    qtyInput.min = '1';
    qtyInput.placeholder = '1';
    qtyInput.style.cssText = 'width:70px;padding:8px;border:1px solid #d1d5db;border-radius:6px;text-align:center';
    qtyInput.oninput = (function(idx) {
      return function() {
        option.equipments[idx].qty = parseInt(this.value) || 1;
        autosave();
      };
    })(i);
    templateRow.appendChild(qtyInput);
    
    eqCard.appendChild(templateRow);
    
    // Show specs input if template selected
    if (eq.template && EQUIPMENT_TEMPLATES[eq.template]) {
      if (!eq.specs) eq.specs = {};
      
      var tmpl = EQUIPMENT_TEMPLATES[eq.template];
      var specsDiv = el('div');
      specsDiv.style.cssText = 'display:grid;grid-template-columns:1fr 1fr;gap:8px;padding-top:10px;border-top:1px solid #e5e7eb';
      
      for (var f = 0; f < tmpl.fields.length; f++) {
        var field = tmpl.fields[f];
        
        var fieldDiv = el('div');
        
        var label = el('label');
        label.style.cssText = 'display:block;font-size:12px;color:#6b7280;margin-bottom:4px';
        label.textContent = field.label + (field.unit ? ' (' + field.unit + ')' : '') + (field.required ? ' *' : '');
        fieldDiv.appendChild(label);
        
        if (field.type === 'select') {
          var select = el('select');
          select.style.cssText = 'width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px';
          
          var emptyOpt = el('option');
          emptyOpt.value = '';
          emptyOpt.textContent = '‚Äî';
          select.appendChild(emptyOpt);
          
          for (var o = 0; o < field.options.length; o++) {
            var opt = el('option');
            opt.value = field.options[o];
            opt.textContent = field.options[o];
            if (eq.specs[field.label] === field.options[o]) opt.selected = true;
            select.appendChild(opt);
          }
          
          select.onchange = (function(idx, lbl) {
            return function() {
              option.equipments[idx].specs[lbl] = this.value;
              autosave();
            };
          })(i, field.label);
          
          fieldDiv.appendChild(select);
        } else {
          var input = el('input');
          input.type = field.type;
          input.value = eq.specs[field.label] || '';
          input.placeholder = field.label;
          input.style.cssText = 'width:100%;padding:6px;border:1px solid #d1d5db;border-radius:4px';
          
          input.oninput = (function(idx, lbl) {
            return function() {
              option.equipments[idx].specs[lbl] = this.value;
              autosave();
            };
          })(i, field.label);
          
          fieldDiv.appendChild(input);
        }
        
        specsDiv.appendChild(fieldDiv);
      }
      
      eqCard.appendChild(specsDiv);
    }
    
    eqList.appendChild(eqCard);
  }
  sysCard.appendChild(eqList);
  
  var addEqBtn = el('button', 'btn pri');
  addEqBtn.textContent = '+ ' + T[LANG].addEquipment;
  addEqBtn.onclick = function() {
    option.equipments.push({name: '', template: '', specs: {}, qty: 1});
    showStep('opts');
    autosave();
  };
  sysCard.appendChild(addEqBtn);
  box.appendChild(sysCard);
  
  // 3. Engineering Items (BOM)
  var bomCard = el('div', 'card');
  
  var bomHeader = el('div');
  bomHeader.style.cssText = 'display:flex;align-items:center;justify-content:space-between;margin-bottom:10px';
  
  var bomTitle = el('h3');
  bomTitle.textContent = '3. ' + T[LANG].engineeringItems + ' üì¶';
  bomTitle.style.margin = '0';
  bomHeader.appendChild(bomTitle);
  
  var genBtn = el('button');
  genBtn.className = 'btn';
  genBtn.style.cssText = 'background:#fbbf24;color:#000;border-color:#f59e0b;font-weight:700;font-size:14px;padding:10px 20px;box-shadow:0 2px 4px rgba(0,0,0,0.1)';
  genBtn.innerHTML = '‚ö° Generate from Equipment';
  genBtn.title = 'Auto-generate BOM items based on equipment templates and specs';
  genBtn.onclick = function() {
    if (confirm('Generate BOM items from equipment specifications?\n\nThis will add items based on templates. Existing items will not be removed.')) {
      generateBOMFromEquipment();
    }
  };
  bomHeader.appendChild(genBtn);
  
  bomCard.appendChild(bomHeader);
  
  var bomNote = el('div');
  bomNote.style.cssText = 'background:#f0fdf4;border-left:4px solid:#bf1122;padding:12px;margin-bottom:16px;border-radius:4px';
  bomNote.innerHTML = '<div style="font-size:12px;color:#00152a;line-height:1.5">' +
    '<b>ü§ñ Auto BOM Generation:</b> Click the button above to automatically generate engineering items from equipment specs. ' +
    'Each template has predefined BOM rules (Equipment, Fabrication, Electrical, Controls, Installation). ' +
    'You can also manually add items using the button below.' +
    '</div>';
  bomCard.appendChild(bomNote);
  
  if (!option.items) option.items = [];
  
  var itemList = el('div');
  itemList.style.cssText = 'display:flex;flex-direction:column;gap:6px;margin-bottom:10px';
  for (var i = 0; i < option.items.length; i++) {
    var item = option.items[i];
    var itemRow = el('div');
    itemRow.style.cssText = 'display:grid;grid-template-columns:120px 1fr 80px 80px 100px 40px;gap:6px;align-items:center;padding:8px;border:1px solid #e5e7eb;border-radius:4px;background:#fff';
    itemRow.innerHTML = '<select style="padding:4px;border:1px solid #ddd;border-radius:4px"><option' + (item.cat === 'Equipment' ? ' selected' : '') + '>Equipment</option><option' + (item.cat === 'Fabrication' ? ' selected' : '') + '>Fabrication</option><option' + (item.cat === 'Installation' ? ' selected' : '') + '>Installation</option><option' + (item.cat === 'Electrical' ? ' selected' : '') + '>Electrical</option><option' + (item.cat === 'Controls' ? ' selected' : '') + '>Controls</option></select>' +
      '<input type="text" value="' + item.desc + '" placeholder="Description" style="padding:4px;border:1px solid #ddd;border-radius:4px">' +
      '<input type="number" value="' + item.qty + '" placeholder="Qty" style="padding:4px;border:1px solid #ddd;border-radius:4px">' +
      '<input type="text" value="' + item.unit + '" placeholder="Unit" style="padding:4px;border:1px solid #ddd;border-radius:4px">' +
      '<select style="padding:4px;border:1px solid #ddd;border-radius:4px"><option' + (item.scope === 'Included' ? ' selected' : '') + '>Included</option><option' + (item.scope === 'Optional' ? ' selected' : '') + '>Optional</option></select>' +
      '<button class="btn dan" style="padding:4px 8px">‚úï</button>';
    itemList.appendChild(itemRow);
    
    var selects = itemRow.querySelectorAll('select');
    var inputs = itemRow.querySelectorAll('input');
    
    selects[0].onchange = (function(idx) {
      return function() {
        option.items[idx].cat = this.value;
        autosave();
      };
    })(i);
    inputs[0].oninput = (function(idx) {
      return function() {
        option.items[idx].desc = this.value;
        autosave();
      };
    })(i);
    inputs[1].oninput = (function(idx) {
      return function() {
        option.items[idx].qty = this.value;
        autosave();
      };
    })(i);
    inputs[2].oninput = (function(idx) {
      return function() {
        option.items[idx].unit = this.value;
        autosave();
      };
    })(i);
    selects[1].onchange = (function(idx) {
      return function() {
        option.items[idx].scope = this.value;
        autosave();
      };
    })(i);
    itemRow.querySelector('button').onclick = (function(idx) {
      return function() {
        option.items.splice(idx, 1);
        showStep('opts');
        autosave();
      };
    })(i);
  }
  bomCard.appendChild(itemList);
  
  var addItemBtn = el('button', 'btn pri');
  addItemBtn.textContent = '+ ' + T[LANG].addItem;
  addItemBtn.onclick = function() {
    option.items.push({cat: 'Equipment', desc: '', qty: 1, unit: 'ea', scope: 'Included'});
    showStep('opts');
    autosave();
  };
  bomCard.appendChild(addItemBtn);
  box.appendChild(bomCard);
  
  // 4. Freight & Notes
  var notesCard = el('div', 'card');
  var notesTitle = el('h3');
  notesTitle.textContent = '4. ' + T[LANG].freight + ' & ' + T[LANG].optionNotes;
  notesCard.appendChild(notesTitle);
  
  notesCard.appendChild(formGrid([
    field({label: T[LANG].freight, type: 'select', w: 'f2', opts: ['Normal', 'Heavy', 'Oversize', 'Special']}, 'options.' + state.activeOption + '.freight'),
    field({label: T[LANG].freightNotes, type: 'text', w: 'f4'}, 'options.' + state.activeOption + '.freight_notes')
  ]));
  
  var notesLabel = el('label');
  notesLabel.textContent = 'Assumptions & Exclusions';
  notesCard.appendChild(notesLabel);
  
  var notesTA = el('textarea');
  notesTA.style.minHeight = '80px';
  notesTA.placeholder = 'Option-specific assumptions, exclusions, or notes...';
  notesTA.value = option.notes || '';
  notesTA.oninput = function() {
    option.notes = notesTA.value;
    autosave();
  };
  notesCard.appendChild(notesTA);
  
  box.appendChild(notesCard);
  
  // Completion Indicator
  var complete = el('div');
  complete.style.cssText = 'margin-top:20px;padding:15px;background:#f0fdf4;border:1px solid #86efac;border-radius:8px';
  var checks = [
    option.summary && option.summary.length > 50,
    option.equipments && option.equipments.length > 0,
    option.items && option.items.length > 0
  ];
  var completePct = Math.round((checks.filter(Boolean).length / checks.length) * 100);
  complete.innerHTML = '<div style="font-weight:700;margin-bottom:8px">Option ' + option.id + ' Completion: ' + completePct + '%</div>' +
    '<div class="small">' +
    (checks[0] ? '‚úì' : '‚óã') + ' Engineering Summary<br>' +
    (checks[1] ? '‚úì' : '‚óã') + ' Systems & Equipments<br>' +
    (checks[2] ? '‚úì' : '‚óã') + ' Engineering Items (BOM)' +
    '</div>';
  box.appendChild(complete);
}

function renderCost(box) {
  var title = el('h2');
  title.textContent = T[LANG].cost;
  box.appendChild(title);
  
  
  // Check if options exist
  if (!state.options || state.options.length === 0) {
    var lockMsg = el('div', 'note');
    lockMsg.style.marginTop = '20px';
    lockMsg.innerHTML = '<b>‚ö†Ô∏è No options created yet</b><br>Please complete Step 04 (Option Builder) first.';
    box.appendChild(lockMsg);
    return;
  }
  
  // Global Settings Card
  var settingsCard = el('div', 'card');
  var settingsTitle = el('h3');
  settingsTitle.textContent = 'Global Pricing Parameters';
  settingsCard.appendChild(settingsTitle);
  
  settingsCard.appendChild(formGrid([
    field({label: T[LANG].laborRate, type: 'number', w: 'f2'}, 'pricing.labor_rate_per_hour'),
    field({label: T[LANG].marginPct, type: 'number', w: 'f1'}, 'pricing.margin_percentage'),
    field({label: T[LANG].freightPct, type: 'number', w: 'f1'}, 'pricing.freight_percentage')
  ]));
  
  box.appendChild(settingsCard);
  
  // Option Comparison Table
  var compCard = el('div', 'card');
  compCard.style.marginTop = '20px';
  var compTitle = el('h3');
  compTitle.textContent = 'Option Comparison';
  compCard.appendChild(compTitle);
  
  var table = el('table');
  table.style.cssText = 'width:100%;border-collapse:collapse;margin-top:12px';
  
  var thead = el('thead');
  var tr = el('tr');
  tr.innerHTML = '<th style="text-align:left;padding:10px;border-bottom:2px solid #ddd;background:#f8f9fa">Metric</th>';
  
  for (var i = 0; i < state.options.length; i++) {
    var opt = state.options[i];
    tr.innerHTML += '<th style="text-align:right;padding:10px;border-bottom:2px solid #ddd;background:#f8f9fa">Option ' + opt.id + '</th>';
  }
  thead.appendChild(tr);
  table.appendChild(thead);
  
  var tbody = el('tbody');
  
  // Calculate costs for each option
  var optionCosts = [];
  for (var i = 0; i < state.options.length; i++) {
    var opt = state.options[i];
    var costs = calculateOptionCosts(opt);
    optionCosts.push(costs);
  }
  
  // Equipment Count
  var row1 = el('tr');
  row1.innerHTML = '<td style="padding:10px;border-bottom:1px solid #eee">Equipment Count</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row1.innerHTML += '<td style="padding:10px;border-bottom:1px solid #eee;text-align:right">' + optionCosts[i].equipmentCount + '</td>';
  }
  tbody.appendChild(row1);
  
  // BOM Items
  var row2 = el('tr');
  row2.innerHTML = '<td style="padding:10px;border-bottom:1px solid #eee">BOM Items</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row2.innerHTML += '<td style="padding:10px;border-bottom:1px solid #eee;text-align:right">' + optionCosts[i].bomCount + '</td>';
  }
  tbody.appendChild(row2);
  
  // Estimated Hours
  var row3 = el('tr');
  row3.innerHTML = '<td style="padding:10px;border-bottom:1px solid #eee">Estimated Hours</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row3.innerHTML += '<td style="padding:10px;border-bottom:1px solid #eee;text-align:right">' + optionCosts[i].totalHours.toFixed(0) + ' hr</td>';
  }
  tbody.appendChild(row3);
  
  // Labor Cost
  var row4 = el('tr');
  row4.innerHTML = '<td style="padding:10px;border-bottom:1px solid #eee">Labor Cost</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row4.innerHTML += '<td style="padding:10px;border-bottom:1px solid #eee;text-align:right;color:#003361;font-weight:600">$' + optionCosts[i].laborCost.toLocaleString() + '</td>';
  }
  tbody.appendChild(row4);
  
  // Total Cost
  var row5 = el('tr');
  row5.innerHTML = '<td style="padding:10px;border-bottom:2px solid #ddd;font-weight:700">Total Cost</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row5.innerHTML += '<td style="padding:10px;border-bottom:2px solid #ddd;text-align:right;font-weight:700;color:#003361">$' + optionCosts[i].totalCost.toLocaleString() + '</td>';
  }
  tbody.appendChild(row5);
  
  // Margin
  var row6 = el('tr');
  row6.innerHTML = '<td style="padding:10px;border-bottom:1px solid #eee">Margin (' + state.pricing.margin_percentage + '%)</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row6.innerHTML += '<td style="padding:10px;border-bottom:1px solid #eee;text-align:right">$' + optionCosts[i].margin.toLocaleString() + '</td>';
  }
  tbody.appendChild(row6);
  
  // Freight
  var row7 = el('tr');
  row7.innerHTML = '<td style="padding:10px;border-bottom:1px solid #eee">Freight (' + state.pricing.freight_percentage + '%)</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row7.innerHTML += '<td style="padding:10px;border-bottom:1px solid #eee;text-align:right">$' + optionCosts[i].freight.toLocaleString() + '</td>';
  }
  tbody.appendChild(row7);
  
  // Selling Price
  var row8 = el('tr');
  row8.style.background = '#f0fdf4';
  row8.innerHTML = '<td style="padding:12px;font-weight:700;font-size:16px">Selling Price</td>';
  for (var i = 0; i < optionCosts.length; i++) {
    row8.innerHTML += '<td style="padding:12px;text-align:right;font-weight:700;font-size:16px;color:#15803d">$' + optionCosts[i].sellingPrice.toLocaleString() + '</td>';
  }
  tbody.appendChild(row8);
  
  table.appendChild(tbody);
  compCard.appendChild(table);
  box.appendChild(compCard);
  
  // Detailed Cost Breakdown per Option
  for (var i = 0; i < state.options.length; i++) {
    var opt = state.options[i];
    var costs = optionCosts[i];
    
    var detailCard = el('div', 'card');
    detailCard.style.marginTop = '20px';
    
    var detailTitle = el('h3');
    detailTitle.innerHTML = 'Option ' + opt.id + ' ‚Äî Detailed Breakdown';
    detailCard.appendChild(detailTitle);
    
    var detailTable = el('table');
    detailTable.style.cssText = 'width:100%;border-collapse:collapse;margin-top:12px';
    
    var detailThead = el('thead');
    var detailTr = el('tr');
    detailTr.innerHTML = '<th style="text-align:left;padding:8px;border-bottom:2px solid #ddd;background:#f8f9fa">Category</th>' +
      '<th style="text-align:left;padding:8px;border-bottom:2px solid #ddd;background:#f8f9fa">Description</th>' +
      '<th style="text-align:center;padding:8px;border-bottom:2px solid #ddd;background:#f8f9fa">Qty</th>' +
      '<th style="text-align:center;padding:8px;border-bottom:2px solid #ddd;background:#f8f9fa">Unit</th>' +
      '<th style="text-align:right;padding:8px;border-bottom:2px solid #ddd;background:#f8f9fa">Est. Hours</th>';
    detailThead.appendChild(detailTr);
    detailTable.appendChild(detailThead);
    
    var detailTbody = el('tbody');
    
    if (!opt.items || opt.items.length === 0) {
      var emptyRow = el('tr');
      emptyRow.innerHTML = '<td colspan="5" style="padding:20px;text-align:center;color:#999">No BOM items defined for this option</td>';
      detailTbody.appendChild(emptyRow);
    } else {
      for (var j = 0; j < opt.items.length; j++) {
        var item = opt.items[j];
        var estHours = estimateHours(item);
        var itemRow = el('tr');
        itemRow.innerHTML = '<td style="padding:8px;border-bottom:1px solid #eee">' + item.cat + '</td>' +
          '<td style="padding:8px;border-bottom:1px solid #eee">' + item.desc + '</td>' +
          '<td style="padding:8px;border-bottom:1px solid #eee;text-align:center">' + item.qty + '</td>' +
          '<td style="padding:8px;border-bottom:1px solid #eee;text-align:center">' + item.unit + '</td>' +
          '<td style="padding:8px;border-bottom:1px solid #eee;text-align:right">' + estHours.toFixed(1) + ' hr</td>';
        detailTbody.appendChild(itemRow);
      }
    }
    
    detailTable.appendChild(detailTbody);
    detailCard.appendChild(detailTable);
    box.appendChild(detailCard);
  }
}

function estimateHours(item) {
  // Simple estimation based on category and quantity
  var baseHours = 0;
  switch (item.cat) {
    case 'Equipment': baseHours = 40; break;
    case 'Fabrication': baseHours = 20; break;
    case 'Installation': baseHours = 16; break;
    case 'Electrical': baseHours = 12; break;
    case 'Controls': baseHours = 24; break;
    default: baseHours = 10;
  }
  return baseHours * (item.qty || 1);
}

function calculateOptionCosts(option) {
  var equipmentCount = (option.equipments || []).length;
  var bomCount = (option.items || []).length;
  
  var totalHours = 0;
  if (option.items) {
    for (var i = 0; i < option.items.length; i++) {
      totalHours += estimateHours(option.items[i]);
    }
  }
  
  var laborRate = state.pricing.labor_rate_per_hour || 125;
  var laborCost = Math.round(totalHours * laborRate);
  var totalCost = laborCost;
  
  var marginPct = state.pricing.margin_percentage || 25;
  var margin = Math.round(totalCost * (marginPct / 100));
  
  var freightPct = state.pricing.freight_percentage || 5;
  var freight = Math.round(totalCost * (freightPct / 100));
  
  var sellingPrice = totalCost + margin + freight;
  
  return {
    equipmentCount: equipmentCount,
    bomCount: bomCount,
    totalHours: totalHours,
    laborCost: laborCost,
    totalCost: totalCost,
    margin: margin,
    freight: freight,
    sellingPrice: sellingPrice
  };
}

function renderContract(box) {
  var title = el('h2');
  title.textContent = T[LANG].contract;
  box.appendChild(title);
  
  // GRILLE TARIFAIRE | MAIN D'OEUVRE
  // Ensure pricing and labor_rates exist
  if (!state.pricing) {
    state.pricing = {
      labor_rate_per_hour: 95,
      margin_percentage: 25,
      freight_percentage: 5,
      travel_rate_km: 0.85,
      accommodation_per_night: 200,
      meal_allowance: 50,
      supplies_per_day: 50,
      overtime_multiplier: 1.5,
      sunday_multiplier: 2.0,
      labor_rates: {},
      notes: ''
    };
  }
  
  if (!state.pricing.labor_rates) {
    state.pricing.labor_rates = {
      engineer_senior: 175.00,
      engineer_standard: 150.00,
      designer: 115.00,
      technician_draftsman: 97.50,
      admin_support: 65.00,
      specialist_dryer: 155.00,
      supervisor_senior: 125.00,
      supervisor_standard: 95.00,
      foreman_mechanical: 90.00,
      mechanic_welder: 85.50,
      assistant_mechanic: 80.50
    };
  }
  
  var tarifCard = el('div', 'card');
  tarifCard.style.background = '#fffbeb';
  tarifCard.style.borderColor = '#fbbf24';
  
  var tarifTitle = el('h3');
  tarifTitle.innerHTML = 'üí∞ GRILLE TARIFAIRE | MAIN D\'OEUVRE';
  tarifCard.appendChild(tarifTitle);
  
  var tarifSubtitle = el('div', 'small');
  tarifSubtitle.style.cssText = 'color:#666;margin-bottom:16px';
  tarifSubtitle.innerHTML = T[LANG].laborRatesValid2025;
  tarifCard.appendChild(tarifSubtitle);
  
  // CONCEPTION ET DESSINS Section
  var conceptionHeader = el('div');
  conceptionHeader.style.cssText = 'font-weight:700;margin-top:12px;margin-bottom:8px;color:#b45309;text-transform:uppercase';
  conceptionHeader.textContent = T[LANG].conceptionDesign;
  tarifCard.appendChild(conceptionHeader);
  
  var conceptionTable = el('table');
  conceptionTable.style.cssText = 'width:100%;border-collapse:collapse;margin-bottom:16px';
  conceptionTable.innerHTML = 
    '<tr><td style="padding:6px;width:60%">√ò ' + T[LANG].engineerSenior + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.engineer_senior + '" onchange="state.pricing.labor_rates.engineer_senior=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr style="background:#fef3c7"><td style="padding:6px">√ò ' + T[LANG].engineerStandard + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.engineer_standard + '" onchange="state.pricing.labor_rates.engineer_standard=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr><td style="padding:6px">√ò ' + T[LANG].designer + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.designer + '" onchange="state.pricing.labor_rates.designer=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr style="background:#fef3c7"><td style="padding:6px">√ò ' + T[LANG].technicianDraftsman + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.technician_draftsman + '" onchange="state.pricing.labor_rates.technician_draftsman=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr><td style="padding:6px">√ò ' + T[LANG].adminSupport + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.admin_support + '" onchange="state.pricing.labor_rates.admin_support=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>';
  tarifCard.appendChild(conceptionTable);
  
  // M√âCANIQUE Section
  var mecaniqueHeader = el('div');
  mecaniqueHeader.style.cssText = 'font-weight:700;margin-top:12px;margin-bottom:8px;color:#b45309;text-transform:uppercase';
  mecaniqueHeader.textContent = T[LANG].mechanicSupervision;
  tarifCard.appendChild(mecaniqueHeader);
  
  var mecaniqueTable = el('table');
  mecaniqueTable.style.cssText = 'width:100%;border-collapse:collapse;margin-bottom:16px';
  mecaniqueTable.innerHTML = 
    '<tr><td style="padding:6px">√ò ' + T[LANG].specialistDryer + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.specialist_dryer + '" onchange="state.pricing.labor_rates.specialist_dryer=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr style="background:#fef3c7"><td style="padding:6px">√ò ' + T[LANG].supervisorSenior + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.supervisor_senior + '" onchange="state.pricing.labor_rates.supervisor_senior=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr><td style="padding:6px">√ò ' + T[LANG].supervisorStandard + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.supervisor_standard + '" onchange="state.pricing.labor_rates.supervisor_standard=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr style="background:#fef3c7"><td style="padding:6px">√ò ' + T[LANG].foremanMechanical + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.foreman_mechanical + '" onchange="state.pricing.labor_rates.foreman_mechanical=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr><td style="padding:6px">√ò ' + T[LANG].mechanicWelder + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.mechanic_welder + '" onchange="state.pricing.labor_rates.mechanic_welder=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr style="background:#fef3c7"><td style="padding:6px">√ò ' + T[LANG].assistantMechanic + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.labor_rates.assistant_mechanic + '" onchange="state.pricing.labor_rates.assistant_mechanic=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / hr</td></tr>' +
    '<tr><td style="padding:6px">√ò ' + T[LANG].supplies + '</td><td style="text-align:right;padding:6px"><input type="number" step="0.01" value="' + state.pricing.supplies_per_day + '" onchange="state.pricing.supplies_per_day=parseFloat(this.value);autosave()" style="width:100px;text-align:right;padding:4px;border:1px solid #ddd;border-radius:4px"/> $ / jour / homme</td></tr>';
  tarifCard.appendChild(mecaniqueTable);
  
  // Additional rates
  var addRatesDiv = el('div');
  addRatesDiv.style.cssText = 'margin-top:16px;padding:12px;background:#fef3c7;border-radius:6px';
  addRatesDiv.innerHTML = 
    '<div style="margin-bottom:8px"><b>' + T[LANG].ratesSubjectToChange + '</b></div>' +
    '<div style="margin-bottom:4px">‚Ä¢ ' + T[LANG].travelFees + ' <b>' + state.pricing.travel_rate_km.toFixed(2) + '$ / km</b> + taux horaire applicable.</div>' +
    '<div style="margin-bottom:4px">‚Ä¢ ' + T[LANG].accommodation + ' <b>' + state.pricing.accommodation_per_night + '$ par nuit</b> s\'ajouteront.</div>' +
    '<div style="margin-bottom:4px">‚Ä¢ ' + T[LANG].mealAllowance + ' <b>' + state.pricing.meal_allowance + '$ / repas</b> s\'ajouteront.</div>' +
    '<div style="margin-bottom:4px">‚Ä¢ ' + T[LANG].overtimeSaturday + ' <b>' + state.pricing.overtime_multiplier + 'x le taux horaire</b>.</div>' +
    '<div>‚Ä¢ ' + T[LANG].sundayHolidays + ' <b>' + state.pricing.sunday_multiplier + 'x le taux horaire</b>.</div>';
  tarifCard.appendChild(addRatesDiv);
  
  box.appendChild(tarifCard);
  
  // 2. NOTES CONTRACTUELLES (Fixed 7 + Additional)
  var notesCard = el('div', 'card');
  notesCard.style.marginTop = '20px';
  
  var notesHeader = el('div');
  notesHeader.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:12px';
  
  var notesTitle = el('h3');
  notesTitle.textContent = 'üìÑ ' + T[LANG].contractNotes;
  notesTitle.style.margin = '0';
  notesHeader.appendChild(notesTitle);
  
  var addNoteBtn = el('button', 'btn pri');
  addNoteBtn.innerHTML = T[LANG].addAdditionalNote;
  addNoteBtn.onclick = function() {
    if (!state.project.contract.additional_notes) state.project.contract.additional_notes = [];
    state.project.contract.additional_notes.push({
      id: uid('NOTE'),
      text: '',
      included: true
    });
    renderContractNotes();
    autosave();
  };
  notesHeader.appendChild(addNoteBtn);
  
  notesCard.appendChild(notesHeader);
  
  var notesInfo = el('div', 'note');
  notesInfo.style.marginBottom = '12px';
  notesInfo.innerHTML = T[LANG].standardTrustechNotes + '<br>' + T[LANG].checkNotesForStep7;
  notesCard.appendChild(notesInfo);
  
  var notesListContainer = el('div');
  notesListContainer.id = 'contractNotesList';
  notesCard.appendChild(notesListContainer);
  
  function renderContractNotes() {
    var container = document.getElementById('contractNotesList');
    if (!container) {
      // If not in Step 6, don't retry
      if (currentTab !== 'contract') {
        return;
      }
      console.log('contractNotesList not found, will retry');
      setTimeout(renderContractNotes, 100);
      return;
    }
    
    container.innerHTML = '';
    
    // Initialize standard 7 notes if not exist
    var standardNotes = [
      { key: 'note1', title: 'TERMES DE PAIEMENT', text: 'TERMES DE PAIEMENT (Section A ou B selon celle retenue par client)\n‚Ä¢ 30% √† la commande (sur r√©ception de facture). Projet d√©but √† la r√©ception du premier paiement.\n‚Ä¢ 20% Net 45 jours √† la remise des dessins d\'atelier.\n‚Ä¢ 30% avant exp√©dition (paiement doit √™tre re√ßu avant exp√©dition).\n‚Ä¢ 20% Net 45 jours suivant installation (max 60 jours apr√®s exp√©dition).\n‚Ä¢ Note: Trustech demeure propri√©taire des √©quipements fournis tant que l\'ensemble des paiements ne sont pas compl√©t√©s par le client.\n‚Ä¢ Note: Tout retard de paiement peut entra√Æner des d√©lais additionnels sur l\'√©ch√©ancier de livraison pr√©vu.' },
      { key: 'note2', title: '√âCH√âANCIER DE LIVRAISON PR√âVU', text: '√âCH√âANCIER DE LIVRAISON PR√âVU\nSuivant r√©ception du premier paiement et du nuage de point (scan 3D) pr√™t √† utiliser avec logiciel Inventor:\n‚Ä¢ Ing√©nierie et remise de dessins d\'atelier: 4 √† 6 semaines\n‚Ä¢ Fabrication: 12-14 semaines (suivant approbation des dessins d\'atelier)' },
      { key: 'note3', title: 'RESPONSABILIT√â DE TRUSTECH', text: 'RESPONSABILIT√â DE TRUSTECH\n‚Ä¢ Conception, fabrication et fourniture des √©l√©ments d√©crits et retenus √† cette soumission.\n‚Ä¢ Ing√©nierie de conception fait en partenariat avec Dynagroup Technologies Inc.\n‚Ä¢ Fonctionnalit√© des √©quipements et composantes.\n‚Ä¢ Suivant remise des dessins d\'atelier, fourniture au client d\'un prix pour r√©seaux de conduits n√©cessaires et r√©seau de d√©charge d\'air √† l\'atmosph√®re. Le tout selon notre grille tarifaire 2025 en vigueur.\n‚Ä¢ Suivant remise des dessins d\'atelier, fourniture au client d\'un prix pour installation m√©canique hors d√©cret. Le tout selon notre grille tarifaire 2025 en vigueur.' },
      { key: 'note4', title: 'RESPONSABILIT√â DU CLIENT', text: 'RESPONSABILIT√â DU CLIENT\n‚Ä¢ Transport, r√©ception et manutention des √©quipements lors de la livraison.\n‚Ä¢ Tous les travaux de nature civil/structure afin de recevoir les nouveaux √©quipements (si requis).\n‚Ä¢ Layout g√©n√©ral des √©quipements, fourniture d\'un scan 3D.\n‚Ä¢ L\'installation compl√®te des √©quipements et composantes.\n‚Ä¢ Tout travaux de nature √©lectrique, instrumentation, contr√¥le, pneumatique, civil, etc.\n‚Ä¢ Source d\'air comprim√©, propre et ass√©ch√© pour alimenter le syst√®me de pulse des d√©poussi√©reurs.\n‚Ä¢ Tous percements de murs, plancher et toit requis dans le cadre du projet.\n‚Ä¢ Toutes modifications aux √©quipements existants afin de recevoir les nouveaux √©quipements et composantes.\n‚Ä¢ Tous travaux ou fourniture non-inclus √† cette proposition.' },
      { key: 'note5', title: 'VALIDIT√â DE LA PROPOSITION', text: 'VALIDIT√â DE LA PROPOSITION\n‚Ä¢ La pr√©sente proposition est valide pour 30 jours.\n‚Ä¢ Voir √©galement la Note 7 pour autres notes et exceptions.' },
      { key: 'note6', title: 'GARANTIES', text: 'GARANTIES\n‚Ä¢ Garantie sur efficacit√© de filtration (au niveau des filtres) pour respecter les normes en vigueur pour le d√©poussi√©reur.\n‚Ä¢ Garantie sur le d√©bit d√©velopp√© par le nouveau ventilateur fourni.\n‚Ä¢ Garantie g√©n√©rale de 1 an sur la fonctionnalit√© des nouveaux √©quipements et composantes fournies, s\'ils sont op√©r√©s selon les recommandations des manufacturiers et de Trustech.\n‚Ä¢ Aucune garantie sur √©quipements, composantes et mat√©riaux existants qui seront r√©utilis√©s.\n‚Ä¢ Option: Si le client d√©sire obtenir une garantie de 2 ans (au lieu de 1 an) sur la fonctionnalit√© des nouveaux √©quipements et composantes fournies par Trustech: le co√ªt associ√© additionnel est de 3500$.\n‚Ä¢ Aucune garantie sur les pi√®ces d\'usure tel que filtres, conduits, etc. √† moins qu\'il s\'agisse d\'un d√©faut de fabrication ou d\'installation.\n‚Ä¢ Aucune garantie sur l\'efficacit√© de capture aux points d\'√©mission de poussi√®res.\n‚Ä¢ Garantie offerte couvre le mat√©riel n√©cessaire et non la main-d\'≈ìuvre requise associ√©e.' },
      { key: 'note7', title: 'NOTES & EXCLUSIONS', text: 'NOTES & EXCLUSIONS\n‚Ä¢ Advenant des d√©lais dans la livraison et disponibilit√© des √©quipements et composantes ci-haut d√©crit qui affecterait les d√©lais de livraison estim√©s pr√©sent√©s √† la Note 2: aucune p√©nalit√©, dommages-int√©r√™ts liquid√©s et/ou quelconque autre retenu sur le prix de vente √©tabli pourra √™tre charg√© √† Trustech ‚Äì Syst√®mes et Proc√©d√©s Inc. Nous ferons tout dans notre possible afin de respecter les d√©lais propos√©s et aviserons le client d√®s que possible advenant de potentielles probl√©matiques.\n‚Ä¢ Suivant exp√©dition des √©quipements et composantes Trustech ne peut √™tre tenu responsable de tous dommages, pertes, vol, bris, etc. du mat√©riel exp√©di√© qui sera sous la responsabilit√© du client.\n‚Ä¢ Aucune caution ne sera fournie par Trustech.\n‚Ä¢ Les prix indiqu√©s √† cette proposition sont bas√©s sur une √©valuation de projet en date d\'Octobre 2025, les diff√©rentes r√©visions subs√©quentes ont √©t√© r√©alis√©es pour adresser des besoins identifi√©s par le client. √Ä cet effet les prix indiqu√©s √† cette proposition ne tiennent pas compte de nouveaux tarifs (US et autres) ou frais exc√©dentaires pouvant √™tre encourus et ce √† partir de Novembre 2024. Advenant cette situation, un ajustement de co√ªt pourrait √™tre n√©cessaire pour palier √† ces augmentations de co√ªt.' }
    ];
    
    // Initialize if not exist
    for (var i = 0; i < standardNotes.length; i++) {
      if (!state.project.contract[standardNotes[i].key]) {
        state.project.contract[standardNotes[i].key] = standardNotes[i].text;
      }
      if (state.project.contract[standardNotes[i].key + '_included'] === undefined) {
        state.project.contract[standardNotes[i].key + '_included'] = true;
      }
    }
    
    // Render standard 7 notes
    for (var i = 0; i < standardNotes.length; i++) {
      var sn = standardNotes[i];
      
      var noteWrapper = el('div');
      noteWrapper.style.cssText = 'margin-top:16px;padding:12px;background:#f0fdf4;border-left:4px solid #003361;border-radius:4px';
      
      var noteHeader = el('div');
      noteHeader.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:8px';
      
      var leftSide = el('div');
      leftSide.style.cssText = 'display:flex;align-items:center;gap:8px';
      
      var checkbox = el('input');
      checkbox.type = 'checkbox';
      checkbox.checked = state.project.contract[sn.key + '_included'] !== false;
      checkbox.onchange = (function(key) {
        return function() {
          state.project.contract[key + '_included'] = this.checked;
          autosave();
        };
      })(sn.key);
      leftSide.appendChild(checkbox);
      
      var noteLabel = el('label');
      noteLabel.textContent = 'NOTE ' + (i + 1) + ': ' + sn.title;
      noteLabel.style.cssText = 'font-weight:700;color:#003361;margin:0;cursor:pointer';
      noteLabel.onclick = function() { checkbox.checked = !checkbox.checked; checkbox.onchange(); };
      leftSide.appendChild(noteLabel);
      
      noteHeader.appendChild(leftSide);
      noteWrapper.appendChild(noteHeader);
      
      var noteInput = el('textarea');
      noteInput.style.cssText = 'width:100%;min-height:100px;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px;line-height:1.5';
      noteInput.value = state.project.contract[sn.key] || '';
      noteInput.oninput = (function(key) {
        return function() {
          state.project.contract[key] = this.value;
          autosave();
        };
      })(sn.key);
      noteWrapper.appendChild(noteInput);
      
      container.appendChild(noteWrapper);
    }
    
    // Separator
    if (state.project.contract.additional_notes && state.project.contract.additional_notes.length > 0) {
      var separator = el('div');
      separator.style.cssText = 'margin:24px 0;border-top:2px solid #003361;padding-top:16px';
      var sepTitle = el('div');
      sepTitle.style.cssText = 'font-weight:700;color:#003361;margin-bottom:8px';
      sepTitle.textContent = T[LANG].additionalNotes;
      separator.appendChild(sepTitle);
      container.appendChild(separator);
    }
    
    // Render additional notes
    if (!state.project.contract.additional_notes) state.project.contract.additional_notes = [];
    
    for (var i = 0; i < state.project.contract.additional_notes.length; i++) {
      var note = state.project.contract.additional_notes[i];
      
      var noteWrapper = el('div');
      noteWrapper.style.cssText = 'margin-top:16px;padding:12px;background:#fef3c7;border-left:4px solid #f59e0b;border-radius:4px';
      
      var noteHeader = el('div');
      noteHeader.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:8px';
      
      var leftSide = el('div');
      leftSide.style.cssText = 'display:flex;align-items:center;gap:8px';
      
      var checkbox = el('input');
      checkbox.type = 'checkbox';
      checkbox.checked = note.included !== false;
      checkbox.onchange = (function(idx) {
        return function() {
          state.project.contract.additional_notes[idx].included = this.checked;
          autosave();
        };
      })(i);
      leftSide.appendChild(checkbox);
      
      var noteLabel = el('label');
      noteLabel.textContent = 'NOTE ' + (7 + i + 1);
      noteLabel.style.cssText = 'font-weight:700;color:#f59e0b;margin:0;cursor:pointer';
      noteLabel.onclick = function() { checkbox.checked = !checkbox.checked; checkbox.onchange(); };
      leftSide.appendChild(noteLabel);
      
      noteHeader.appendChild(leftSide);
      
      var noteActions = el('div');
      noteActions.style.cssText = 'display:flex;gap:6px';
      
      // Move Up
      if (i > 0) {
        var upBtn = el('button', 'btn');
        upBtn.innerHTML = '‚Üë';
        upBtn.style.cssText = 'padding:2px 8px;font-size:16px';
        upBtn.onclick = (function(idx) {
          return function() {
            var temp = state.project.contract.additional_notes[idx];
            state.project.contract.additional_notes[idx] = state.project.contract.additional_notes[idx - 1];
            state.project.contract.additional_notes[idx - 1] = temp;
            renderContractNotes();
            autosave();
          };
        })(i);
        noteActions.appendChild(upBtn);
      }
      
      // Move Down
      if (i < state.project.contract.additional_notes.length - 1) {
        var downBtn = el('button', 'btn');
        downBtn.innerHTML = '‚Üì';
        downBtn.style.cssText = 'padding:2px 8px;font-size:16px';
        downBtn.onclick = (function(idx) {
          return function() {
            var temp = state.project.contract.additional_notes[idx];
            state.project.contract.additional_notes[idx] = state.project.contract.additional_notes[idx + 1];
            state.project.contract.additional_notes[idx + 1] = temp;
            renderContractNotes();
            autosave();
          };
        })(i);
        noteActions.appendChild(downBtn);
      }
      
      // Delete
      var delBtn = el('button', 'btn dan');
      delBtn.innerHTML = '‚úï';
      delBtn.style.cssText = 'padding:2px 8px';
      delBtn.onclick = (function(idx) {
        return function() {
          if (confirm(T[LANG].deleteAdditionalNote)) {
            state.project.contract.additional_notes.splice(idx, 1);
            renderContractNotes();
            autosave();
          }
        };
      })(i);
      noteActions.appendChild(delBtn);
      
      noteHeader.appendChild(noteActions);
      noteWrapper.appendChild(noteHeader);
      
      var noteInput = el('textarea');
      noteInput.style.cssText = 'width:100%;min-height:100px;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px;line-height:1.5';
      noteInput.value = note.text || '';
      noteInput.oninput = (function(idx) {
        return function() {
          state.project.contract.additional_notes[idx].text = this.value;
          autosave();
        };
      })(i);
      noteWrapper.appendChild(noteInput);
      
      container.appendChild(noteWrapper);
    }
  }
  
  renderContractNotes();
  box.appendChild(notesCard);
}


function renderPreview(box) {
  var title = el('h2');
  title.textContent = T[LANG].preview;
  box.appendChild(title);
  
  // Preview Document
  var previewDoc = el('div');
  previewDoc.id = 'previewDocument';
  previewDoc.style.cssText = 'max-width:900px;margin:0 auto;background:#fff;box-shadow:0 4px 6px rgba(0,0,0,0.1);padding:40px';
  
  // Header
  var header = el('div');
  header.style.cssText = 'display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;padding-bottom:20px;border-bottom:3px solid #003361';
  
  var logo = el('img');
  logo.src = 'data:image/png;base64,UklGRlBuAABXRUJQVlA4WAoAAAAwAAAAzwcAzwcASUNDUMgBAAAAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADZBTFBIEiwAAAEktm0bSRL7L3vfu2yziJiAPM1K6EaVkGy2Rcb+CWd2O7fbZc09T38AQL1u0v/fyexedDHKaKFsClqggGycLCeoDMGXomhRpgt4KeAWQUFRQdHyAlGGG2XJLIKyV5FVoIPSXdp0JE1uzh/g693cc57nXpq83kTEBEjdtu38n+9vtm0vm8leWlMzmhHtdTOybs1eUl+zze8fMHx+e57P7zgjYgLgpv/5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5n//5/6b/+Z//+Z//+Z//+b8M1ZBCMuJ/mVmQ5IM3/cd//Md//Md//Md//Md//Md//Md//Md//Md//Md//HfTf/x303/S0zhelK3/V5ZxH4rSOSiZYvj/MquNhP+NfdN//Md//Md//HfTf/zHf/zHf/zHf/zHf/zHf/zHfzf9d9N/N/3Hf/z3GzdeqdUDfL5MW0n380CpMExbTPFOrUY71OqtSl9+Qbq2CKn4Td+86T/+47+b/uM//uM//vtf2GQS3brKBiBd/uM//uM//uO/m/7jP/7jP/7jP/676T/+4786CZi/8LtBffGb/uM//uM//uO/m/676b+b/rvpv5v+4z/++38Yte0xIfWFtLSVRzL+eWdaWtoLqSO6NdOt/LqNSJ2TlvZbxj/uT0tLm/ZMn86aJaLbQ6mz09K+zvjn79LS3k99ukcr7RTXKzU1LW1txvVPrEpblDrsVp8TTXqMmr1o9Y7zxejZvNM7Vs+fPqpnpD5kShwyacG69AvVWPcV57evWvD8nZ2s2iDklkenL/p57yUHevBKxvaV7068u52fVgm45dG3Vmy7iHWdu2P1vHFdQ30/GBs07/7SpipUe+W307s1DzfqN6HNk+fsRhU7j74+MCHcKG/mmNYPLz2PalZOvndvyyizpjBFd5y6A1VZ++fkNtHG+nTd/jFcJ7L0WfB3ng2Jum25R+Z31WVavHgg24aqd1dfPv56eymz3L3iTGEtEqzJ//uLOzVD5LTTBbWoXmfB4anB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yZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJkyZMmTJ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f8FGP+P6IxF2yPW4ClBcMrH4Sua9lrMGCtpMRCzQBE5BzyYpwxmfb4PqXAl6ADMnIWLFixYsWLFiwY7673g66y27v9nODcKBqizTcOljwXmfMtlOm+sJXOJf5czbK1oUvvmjz4E/BXp8z5aznBqC2UdcxMg0HnnRks8DCkTZq2xOwgSb5A4/0lMaeWPA+tu8F5lso5YTJrQ4o1x1KA83FKwNMKBkyXiwlRf394Etd8ljiQr72Tv4F8MqO+u94Oustu8E2UczTU+y+i8F5dhUH169evXr169evXr169evXr169evXbH+qkwd/vpbp0eF6vTem9IkyZMmTJkyZDnTlU14dEn169d7vTem9NOrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWrVq1atWr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';
  logo.alt = 'Trustech';
  logo.style.cssText = 'height:auto;width:250px;max-width:100%';
  header.appendChild(logo);
  
  var quotInfo = el('div');
  quotInfo.style.cssText = 'text-align:right';
  quotInfo.innerHTML = '<h1 style="color:#003361;margin:0;font-size:36px;font-weight:700">QUOTATION</h1>' +
    '<p style="color:#6b7280;margin:8px 0 0;font-size:16px">Quote #: ' + (state.project.header.quote_id || '-') + ' / R' + (state.project.header.rev || '00') + '</p>';
  header.appendChild(quotInfo);
  previewDoc.appendChild(header);
  
  // Project Info
  var infoGrid = el('div');
  infoGrid.style.cssText = 'display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px';
  
  var h = state.project.header;
  var leftCol = el('div');
  leftCol.innerHTML = '<p style="margin:5px 0;font-size:14px"><b>PROJECT:</b><br>' + (h.project_name || '-') + '</p>' +
    '<p style="margin:15px 0 5px;font-size:14px"><b>SITE LOCATION:</b><br>' + (h.site_location || '-') + '</p>';
  infoGrid.appendChild(leftCol);
  
  var rightCol = el('div');
  rightCol.innerHTML = '<p style="margin:5px 0;font-size:14px"><b>CLIENT:</b><br>' + (h.client || '-') + '</p>' +
    '<p style="margin:15px 0 5px;font-size:14px"><b>VALIDITY DATE:</b><br>' + (h.validity_date || '-') + '</p>';
  infoGrid.appendChild(rightCol);
  previewDoc.appendChild(infoGrid);
  
  // Options Summary
  if (state.options && state.options.length > 0) {
    var optTitle = el('h2');
    optTitle.style.cssText = 'color:#003361;border-bottom:2px solid #bf1122;padding-bottom:10px;margin:30px 0 20px';
    optTitle.textContent = 'Options Summary';
    previewDoc.appendChild(optTitle);
    
    for (var i = 0; i < state.options.length; i++) {
      var opt = state.options[i];
      var optCard = el('div');
      optCard.style.cssText = 'border:2px solid #003361;border-radius:8px;padding:20px;margin-bottom:20px;background:#f9fafb;page-break-inside:avoid';
      
      var optHeader = el('h3');
      optHeader.style.cssText = 'color:#003361;margin:0 0 15px';
      optHeader.textContent = 'Option ' + opt.id + ' ‚Äî ' + opt.type;
      optCard.appendChild(optHeader);
      
      // Engineering Summary
      if (opt.engineering_summary) {
        var summary = el('div');
        summary.style.cssText = 'background:#fff;padding:15px;border-radius:6px;margin-bottom:15px;border-left:4px solid #003361';
        summary.innerHTML = '<b style="color:#003361">Engineering Summary:</b><br>' +
          '<p style="margin:10px 0;white-space:pre-wrap;line-height:1.6;font-size:13px">' + opt.engineering_summary + '</p>';
        optCard.appendChild(summary);
      }
      
      // Equipment List
      if (opt.equipments && opt.equipments.length > 0) {
        var eqTitle = el('h4');
        eqTitle.style.cssText = 'color:#003361;margin:15px 0 10px;font-size:14px';
        eqTitle.textContent = 'Equipment (' + opt.equipments.length + ')';
        optCard.appendChild(eqTitle);
        
        for (var e = 0; e < opt.equipments.length; e++) {
          var eq = opt.equipments[e];
          var eqItem = el('div');
          eqItem.style.cssText = 'padding:8px;background:#fff;border-radius:4px;margin-bottom:6px;font-size:13px';
          eqItem.innerHTML = '<b>' + (eq.name || 'Equipment ' + (e+1)) + '</b>' +
            (eq.template ? ' <span style="color:#6b7280;font-size:11px">(' + eq.template + ')</span>' : '') +
            ' <span style="color:#003361;font-weight:600">√ó ' + (eq.qty || 1) + '</span>';
          optCard.appendChild(eqItem);
        }
      }
      
      // BOM Items Count
      if (opt.items && opt.items.length > 0) {
        var bomInfo = el('p');
        bomInfo.style.cssText = 'margin-top:15px;color:#6b7280;font-size:13px';
        bomInfo.innerHTML = '<b>BOM Items:</b> ' + opt.items.length + ' engineering items';
        optCard.appendChild(bomInfo);
      }
      
      previewDoc.appendChild(optCard);
    }
  } else {
    var noOptions = el('p');
    noOptions.style.cssText = 'color:#6b7280;font-style:italic;margin:20px 0';
    noOptions.textContent = 'No options configured yet. Please configure options in Step 4.';
    previewDoc.appendChild(noOptions);
  }
  
  box.appendChild(previewDoc);
  
  // Export Buttons
  var exportBar = el('div');
  exportBar.className = 'exportBar';
  exportBar.style.cssText = 'margin-top:40px;padding-top:20px;border-top:2px solid #e5e7eb;text-align:center';
  
  var exportBtn = el('button');
  exportBtn.className = 'btn pri';
  exportBtn.style.cssText = 'margin:0 10px;padding:12px 30px;font-size:16px;cursor:pointer;z-index:10;position:relative';
  exportBtn.innerHTML = 'üìÑ Export to PDF';
  exportBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    console.log('Export PDF button clicked');
    
    // Simple, direct approach
    var quoteId = '';
    var rev = '';
    try {
      quoteId = state.project.header.quote_id || 'DRAFT';
      rev = state.project.header.rev || '00';
    } catch (e) {
      quoteId = 'DRAFT';
      rev = '00';
    }
    
    var filename = 'Quotation_' + quoteId + '_R' + rev;
    document.title = filename;
    
    console.log('Opening print dialog for:', filename);
    
    // Give browser time to update title
    setTimeout(function() {
      try {
        window.print();
        console.log('Print dialog opened');
      } catch (err) {
        console.error('Print error:', err);
        alert('Cannot open print dialog. Please use Ctrl+P to print.');
      }
    }, 200);
  });
  exportBar.appendChild(exportBtn);
  
  var printBtn = el('button');
  printBtn.className = 'btn';
  printBtn.style.cssText = 'margin:0 10px;padding:12px 30px;font-size:16px;background:#6b7280;color:#fff;cursor:pointer;z-index:10;position:relative';
  printBtn.innerHTML = 'üñ®Ô∏è Print';
  printBtn.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    console.log('Print button clicked');
    window.print();
  });
  exportBar.appendChild(printBtn);
  
  box.appendChild(exportBar);
}


function renderEquip(box) {
  var title = el('h2');
  title.textContent = T[LANG].equip;
  box.appendChild(title);
  
  if (state.active === null || state.equipments.length === 0) {
    var msg = el('div', 'note');
    msg.textContent = 'No equipment selected. Click Add to create one.';
    box.appendChild(msg);
    return;
  }
  
  var eq = state.equipments[state.active];
  var info = el('div', 'card');
  info.innerHTML = '<h3>Equipment: ' + eq.id + '</h3><div class="small">System: ' + eq.system + '</div>';
  box.appendChild(info);
}


function showEquipmentEditor() {
  if (state.activeOption === null || state.activeEquipment === null) return;
  var option = state.options[state.activeOption];
  var eq = option.equipments[state.activeEquipment];
  if (!eq) return;
  
  // Create modal overlay
  var overlay = el('div');
  overlay.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;display:flex;align-items:center;justify-content:center';
  
  var modal = el('div');
  modal.style.cssText = 'background:#fff;border-radius:12px;padding:20px;max-width:600px;width:90%;max-height:80vh;overflow:auto';
  
  var title = el('h3');
  title.textContent = 'Edit Equipment: ' + eq.name;
  modal.appendChild(title);
  
  // Equipment name
  var nameLabel = el('label');
  nameLabel.textContent = 'Equipment Name';
  modal.appendChild(nameLabel);
  var nameInput = el('input');
  nameInput.value = eq.name || '';
  nameInput.style.cssText = 'width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;margin-bottom:12px';
  nameInput.oninput = function() {
    eq.name = nameInput.value;
    autosave();
  };
  modal.appendChild(nameInput);
  
  // Specs section
  var specsTitle = el('h4');
  specsTitle.textContent = 'Specifications';
  specsTitle.style.marginTop = '16px';
  modal.appendChild(specsTitle);
  
  if (!eq.specs) eq.specs = [];
  
  var specsList = el('div');
  specsList.style.cssText = 'display:flex;flex-direction:column;gap:8px;margin-bottom:12px';
  
  function renderSpecs() {
    specsList.innerHTML = '';
    for (var i = 0; i < eq.specs.length; i++) {
      var spec = eq.specs[i];
      var specRow = el('div');
      specRow.style.cssText = 'display:grid;grid-template-columns:1fr 1fr 40px;gap:8px;align-items:center';
      
      var paramInput = el('input');
      paramInput.value = spec.param || '';
      paramInput.placeholder = 'Parameter (e.g., CFM)';
      paramInput.style.cssText = 'padding:6px;border:1px solid #ddd;border-radius:4px';
      paramInput.oninput = (function(idx) {
        return function() {
          eq.specs[idx].param = this.value;
          autosave();
        };
      })(i);
      
      var valueInput = el('input');
      valueInput.value = spec.value || '';
      valueInput.placeholder = 'Value (e.g., 10,000)';
      valueInput.style.cssText = 'padding:6px;border:1px solid #ddd;border-radius:4px';
      valueInput.oninput = (function(idx) {
        return function() {
          eq.specs[idx].value = this.value;
          autosave();
        };
      })(i);
      
      var delBtn = el('button', 'btn dan');
      delBtn.textContent = '‚úï';
      delBtn.style.cssText = 'padding:6px 8px';
      delBtn.onclick = (function(idx) {
        return function() {
          eq.specs.splice(idx, 1);
          renderSpecs();
          autosave();
        };
      })(i);
      
      specRow.appendChild(paramInput);
      specRow.appendChild(valueInput);
      specRow.appendChild(delBtn);
      specsList.appendChild(specRow);
    }
  }
  
  renderSpecs();
  modal.appendChild(specsList);
  
  var addSpecBtn = el('button', 'btn pri');
  addSpecBtn.textContent = '+ Add Specification';
  addSpecBtn.onclick = function() {
    eq.specs.push({param: '', value: ''});
    renderSpecs();
    autosave();
  };
  modal.appendChild(addSpecBtn);
  
  // Close button
  var closeBtn = el('button', 'btn');
  closeBtn.textContent = 'Close';
  closeBtn.style.cssText = 'margin-top:16px;width:100%';
  closeBtn.onclick = function() {
    document.body.removeChild(overlay);
    paintOptionEquipList();
  };
  modal.appendChild(closeBtn);
  
  overlay.appendChild(modal);
  document.body.appendChild(overlay);
  
  overlay.onclick = function(e) {
    if (e.target === overlay) {
      document.body.removeChild(overlay);
      paintOptionEquipList();
    }
  };
}

function paintList() {
  var ul = $('#equipList');
  ul.innerHTML = '';
  for (var i = 0; i < state.equipments.length; i++) {
    var e = state.equipments[i];
    var li = el('div', 'card' + (i === state.active ? ' sel' : ''));
    li.innerHTML = '<div class="flex"><b>' + e.id + '</b><span class="badge">' + e.system + '</span></div>';
    li.onclick = (function(idx) {
      return function() {
        state.active = idx;
        showStep('equip');
      };
    })(i);
    ul.appendChild(li);
  }
}

// New equipment handler for Option-based system
var addEquipBtn = $('#addEquipToOption');
if (addEquipBtn) {
  addEquipBtn.onclick = function() {
    if (state.activeOption === null || state.activeOption === undefined) return;
    var option = state.options[state.activeOption];
    if (!option) return;
    
    var sys = $('#sysSelect').value;
    if (!option.equipments) option.equipments = [];
    
    option.equipments.push({
      name: sys,
      specs: []
    });
    
    state.activeEquipment = option.equipments.length - 1;
    paintOptionEquipList();
    autosave();
    
    // Automatically open editor for new equipment
    setTimeout(function() {
      showEquipmentEditor();
    }, 100);
  };
}

$('#saveProject').onclick = function() {
  var blob = new Blob([JSON.stringify(state, null, 2)], {type: 'application/json'});
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'project-v06.json';
  a.click();
};

$('#loadBtn').onclick = function() {
  $('#loadProject').click();
};

$('#resetBtn').onclick = function() {
  if (confirm('Are you sure you want to clear ALL data and reset the application?\n\nThis cannot be undone!')) {
    localStorage.removeItem('qb_state_v09');
    location.reload();
  }
};

$('#loadProject').onchange = function(e) {
  var f = e.target.files[0];
  if (!f) return;
  var r = new FileReader();
  r.onload = function() {
    try {
      state = JSON.parse(r.result);
      paintList();
      showStep(currentTab || 'project');
      autosave();
    } catch (err) {
      alert('Invalid JSON');
    }
  };
  r.readAsText(f);
};

function setLang(l) {
  LANG = l;
  var btns = document.querySelectorAll('.lang button');
  for (var i = 0; i < btns.length; i++) {
    btns[i].classList.toggle('active', btns[i].id === 'btn' + l);
  }
  paintTabs();
  showStep(currentTab || 'project');
}

$('#btnEN').onclick = function() { setLang('EN'); };
$('#btnFR').onclick = function() { setLang('FR'); };

async function generateAISummary(docIdx) {
  var doc = state.project.header.documents[docIdx];
  if (!doc) return;
  
  var summaryBtn = event.target;
  summaryBtn.disabled = true;
  summaryBtn.textContent = '‚è≥ Generating...';
  
  try {
    // Extract text content from different file types
    var textContent = '';
    
    if (doc.content.startsWith('data:text/')) {
      // Text files
      var base64 = doc.content.split(',')[1];
      textContent = atob(base64);
    } else if (doc.content.startsWith('data:application/pdf')) {
      // PDF - show message that PDF processing is limited
      textContent = '[PDF Document: ' + doc.name + ']\nNote: PDF text extraction requires server-side processing. Using filename and metadata for summary.';
    } else {
      // Other files
      textContent = '[File: ' + doc.name + ', Type: ' + doc.type + ', Size: ' + (doc.size/1024).toFixed(1) + 'KB]';
    }
    
    // Call Claude API
    var response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        messages: [{
          role: 'user',
          content: 'You are analyzing a document for an industrial quotation project. Summarize the key points, requirements, specifications, or decisions from this document in 2-3 concise bullet points.\n\nDocument Type: ' + doc.type + '\nDocument Name: ' + doc.name + '\n\nContent:\n' + textContent.substring(0, 5000)
        }]
      })
    });
    
    if (!response.ok) {
      throw new Error('API request failed: ' + response.status);
    }
    
    var data = await response.json();
    var summary = '';
    
    if (data.content && data.content.length > 0) {
      summary = data.content.map(function(block) {
        return block.type === 'text' ? block.text : '';
      }).join('');
    }
    
    if (summary) {
      doc.summary = summary;
      autosave();
      renderDocumentList();
    } else {
      alert('No summary generated');
    }
    
  } catch (error) {
    console.error('AI Summary Error:', error);
    alert('Failed to generate summary: ' + error.message + '\n\nNote: This feature uses the Claude API which may require configuration.');
    summaryBtn.disabled = false;
    summaryBtn.innerHTML = '‚ú® ' + T[LANG].aiSummary;
  }
}

window.addEventListener('DOMContentLoaded', function() {
  try {
    var raw = localStorage.getItem('qb_state_v09');
    if (raw) {
      state = JSON.parse(raw);
    }
  } catch (e) {}
  
  paintTabs();
  setLang('EN');
  
  if (state.equipments.length === 0) {
    var sys = $('#sysSelect').value;
    var id = uid(sys);
    state.equipments.push({id: id, system: sys, data: {}, common: {}});
    state.active = 0;
  }
  
  if (state.activeOption === undefined || state.activeOption === null) {
    state.activeOption = 0;
  }
  
  paintList();
  showStep('project');
  computeProgress();
  
  // Ensure progress bar is visible and updates
  setTimeout(function() {
    computeProgress();
    console.log('Progress bar initialized');
  }, 100);
});
</script>
</body>
</html>
